<!DOCTYPE html>
<!-- saved from url=(0061)https://blog.openreplay.com/building-a-chess-game-with-react/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Google tag (gtag.js) --><script async="" src="./Building a Chess Game with React_files/js"></script>



<!-- Global Metadata -->

<meta name="viewport" content="width=device-width">
<link rel="sitemap" href="https://blog.openreplay.com/sitemap.xml">
<link rel="icon" type="image/x-icon" href="https://blog.openreplay.com/images/favicon.ico">

<link rel="canonical" href="https://blog.openreplay.com/building-a-chess-game-with-react/">

<!-- Primary Meta Tags -->
<title>Building a Chess Game with React</title>
<meta name="title" content="Building a Chess Game with React">
<meta name="description" content="Implement a multiplayer chess game using React and Socket.io">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://blog.openreplay.com/building-a-chess-game-with-react">
<meta property="og:title" content="Building a Chess Game with React">
<meta property="og:description" content="Implement a multiplayer chess game using React and Socket.io">
<meta property="og:image" content="https://blog.openreplay.com/assets/hero_Z15J91m.png">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://blog.openreplay.com/building-a-chess-game-with-react">
<meta property="twitter:title" content="Building a Chess Game with React">
<meta property="twitter:description" content="Implement a multiplayer chess game using React and Socket.io">
<meta property="twitter:image" content="https://blog.openreplay.com/assets/hero_Z15J91m.png">

<link rel="apple-touch-icon" sizes="48x48" href="https://blog.openreplay.com/icons/icon-48x48.png">
<link rel="apple-touch-icon" sizes="72x72" href="https://blog.openreplay.com/icons/icon-72x72.png">
<link rel="apple-touch-icon" sizes="96x96" href="https://blog.openreplay.com/icons/icon-96x96.png">
<link rel="apple-touch-icon" sizes="144x144" href="https://blog.openreplay.com/icons/icon-144x144.png">
<link rel="apple-touch-icon" sizes="192x192" href="https://blog.openreplay.com/icons/icon-192x192.png">
<link rel="apple-touch-icon" sizes="256x256" href="https://blog.openreplay.com/icons/icon-256x256.png">
<link rel="apple-touch-icon" sizes="384x384" href="https://blog.openreplay.com/icons/icon-384x384.png">
<link rel="apple-touch-icon" sizes="512x512" href="https://blog.openreplay.com/icons/icon-512x512.png">

<!-- Pinterest tag -->
<meta name="p:domain_verify" content="db67feb604387517701cc8bb2cc55359">

<!-- Prism CSS -->
<link rel="stylesheet" href="./Building a Chess Game with React_files/prism-tomorrow.min.css">
<link rel="stylesheet" href="./Building a Chess Game with React_files/prism-toolbar.min.css">

<!-- Fonts -->
<link href="./Building a Chess Game with React_files/css2" rel="stylesheet">

<script src="./Building a Chess Game with React_files/bootstrap.bundle.min.js.download" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>

<!-- OpenReplay Tracking Code for OpenReplay Blog -->

    
  <link rel="stylesheet" href="./Building a Chess Game with React_files/_author_.a156b523.css">
<link rel="stylesheet" href="./Building a Chess Game with React_files/index.f8282c34.css">
<link rel="stylesheet" href="./Building a Chess Game with React_files/index.dd6350b7.css">
<link rel="stylesheet" href="./Building a Chess Game with React_files/index.5b12ff5f.css"><script type="module" src="./Building a Chess Game with React_files/hoisted.e8ae1362.js.download"></script></head>
  <body>
    <link rel="stylesheet" href="./Building a Chess Game with React_files/satellite-min.css" integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin="anonymous">
<nav>
  <div class="max-w-7xl mx-auto px-4 xl:px-0 py-5 flex items-center justify-between flex-row 2xs:flex-col xs:flex-col md:flex-row xs:gap-3">
      <div class="w-full flex xs:items-end justify-between">
        <div class="flex items-end">
      <a href="https://openreplay.com/" class="or-brand" data-a11y="false" title="Navigate back to the homepage" aria-label="Navigate back to the homepage" target="_blank">
          <div class="css-1pmvh64 emp30d10">
            <svg height="30px" viewBox="0 0 179 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
              <title>OpenReplay</title>
              <g id="logos" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="Open-Replay" fill-rule="nonzero">
                  <g id="Group-Copy" transform="translate(0.000000, 0.000000)">
                    <path d="M22.4262619,15 L3.29604084,3.77288564 L3.29604084,26.2271144 L22.4262619,15 Z M25.0367262,12.6792184 C25.8592781,13.1556443 26.3667376,14.0411275 26.3667376,15 C26.3667376,15.9588725 25.8592781,16.8443557 25.0367262,17.3207816 L4.06401836,29.6315942 C2.35007712,30.6386 0,29.4882126 0,27.3108127 L0,2.68918734 C0,0.511787376 2.35007712,-0.638600048 4.06401836,0.368405755 L25.0367262,12.6792184 Z" id="Combined-Shape" fill="#394EFF"></path>
                    <path d="M13.7524069,14.3811249 C13.9742492,14.5081718 14.1111111,14.7443007 14.1111111,15 C14.1111111,15.2556993 13.9742492,15.4918282 13.7524069,15.6188751 L8.09606605,18.9017585 C7.63381597,19.1702933 7,18.8635234 7,18.2828834 L7,11.7171166 C7,11.1364766 7.63381597,10.8297067 8.09606605,11.0982415 L13.7524069,14.3811249 Z" id="Path-Copy" fill="#3EAAAF"></path>
                    <path d="M60.0272706,8.76855581 C61.1027831,8.76855581 62.0909102,9.01047676 62.9916519,9.49431864 C63.8923936,9.97816052 64.6116426,10.7532035 65.1493989,11.8194477 C65.6871551,12.8856918 65.9560332,14.2968973 65.9560332,16.0530642 C65.9560332,17.7733908 65.6625079,19.2181965 65.0754574,20.387481 C64.4884068,21.5567656 63.6167936,22.439329 62.4606176,23.0351713 C61.3044417,23.6310136 59.8749063,23.9289348 58.1720116,23.9289348 C57.8403952,23.9289348 57.5065382,23.9154947 57.1704406,23.8886146 C56.8343429,23.8617345 56.5228924,23.8303744 56.2360891,23.7945343 L56.2360891,23.7945343 L56.2360891,29.5737568 L52.7003418,29.5737568 L52.7003418,8.9970367 L55.6848889,8.9970367 L55.8999914,10.5829629 L56.0747622,10.5829629 L56.2416557,10.3830421 C56.6440626,9.92832033 57.137391,9.55591888 57.7216407,9.26583775 C58.3893547,8.93431646 59.157898,8.76855581 60.0272706,8.76855581 Z M137.230204,8.76575595 C138.305716,8.76575595 139.293844,9.00767689 140.194585,9.49151877 C141.095327,9.97536066 141.814576,10.7504037 142.352332,11.8166478 C142.890088,12.882892 143.158967,14.2940975 143.158967,16.0502643 C143.158967,17.770591 142.865441,19.2153966 142.278391,20.3846812 C141.69134,21.5539657 140.819727,22.4365291 139.663551,23.0323715 C138.507375,23.6282138 137.07784,23.9261349 135.374945,23.9261349 C135.043329,23.9261349 134.709472,23.9126949 134.373374,23.8858148 C134.037276,23.8589347 133.725826,23.8275745 133.439022,23.7917344 L133.439022,23.7917344 L133.439022,29.5709569 L129.903275,29.5709569 L129.903275,8.99423684 L132.887822,8.99423684 L133.102925,10.580163 L133.277696,10.580163 L133.444589,10.3802422 C133.846996,9.92552046 134.340324,9.55311901 134.924574,9.26303788 C135.592288,8.93151659 136.360831,8.76575595 137.230204,8.76575595 Z M166.871915,8.99423684 L170.744603,20.5983309 L174.709713,8.99423684 L178.205128,8.99423684 L170.770648,29.5709569 L167.288676,29.5709569 L169.439701,23.6573339 L168.458296,23.6573339 L163.174841,8.99423684 L166.871915,8.99423684 Z M73.8289804,8.76855581 C75.1464832,8.76855581 76.2600867,9.05303692 77.169791,9.62199914 C78.0794954,10.1909613 78.7673752,11.0444047 79.2334306,12.1823291 C79.699486,13.3202535 79.9325138,14.735939 79.9325138,16.4293856 L79.9325138,16.4293856 L79.9325138,17.3836293 L70.8684595,17.3836406 L70.8703874,17.4241362 C70.9120884,18.2460949 71.0580419,18.9202753 71.308248,19.4466774 C71.6084952,20.0783598 72.0947165,20.5308416 72.7669118,20.8041226 C73.4391071,21.0774037 74.3398488,21.2140442 75.4691369,21.2140442 C76.033781,21.2140442 76.6253128,21.1692441 77.2437325,21.0796437 C77.8621522,20.9900434 78.4984971,20.8646029 79.1527672,20.7033222 L79.1527672,20.7033222 L79.1527672,23.4047728 L78.7056229,23.511218 C78.115525,23.6445433 77.5498055,23.7434621 77.0084642,23.8079743 C76.3317876,23.8886146 75.6573516,23.9289348 74.9851563,23.9289348 C73.2553737,23.9289348 71.8235977,23.6668538 70.6898283,23.1426917 C69.5560589,22.6185297 68.7113334,21.7964465 68.155652,20.6764421 C67.5999705,19.5564378 67.3221298,18.1049121 67.3221298,16.3218652 C67.3221298,14.6642588 67.5798046,13.2754533 68.0951544,12.155449 C68.6105041,11.0354446 69.3521596,10.1909613 70.3201209,9.62199914 C71.2880821,9.05303692 72.4577019,8.76855581 73.8289804,8.76855581 Z M122.084104,8.76575595 C123.401606,8.76575595 124.51521,9.05023706 125.424914,9.61919927 C126.334619,10.1881615 127.022498,11.0416048 127.488554,12.1795292 C127.954609,13.3174537 128.187637,14.7331392 128.187637,16.4265858 L128.187637,16.4265858 L128.187637,17.3808295 L119.123573,17.3808407 L119.125511,17.4213363 C119.167212,18.243295 119.313165,18.9174754 119.563371,19.4438775 C119.863618,20.0755599 120.34984,20.5280417 121.022035,20.8013228 C121.69423,21.0746038 122.594972,21.2112444 123.72426,21.2112444 C124.288904,21.2112444 124.880436,21.1664442 125.498856,21.0768438 C126.117275,20.9872435 126.75362,20.861803 127.40789,20.7005224 L127.40789,20.7005224 L127.40789,23.4019729 L126.960746,23.5084181 C126.370648,23.6417434 125.804929,23.7406622 125.263587,23.8051745 C124.586911,23.8858148 123.912475,23.9261349 123.24028,23.9261349 C121.510497,23.9261349 120.078721,23.6640539 118.944952,23.1398919 C117.811182,22.6157298 116.966457,21.7936466 116.410775,20.6736423 C115.855094,19.5536379 115.577253,18.1021123 115.577253,16.3190653 C115.577253,14.6614589 115.834928,13.2726535 116.350278,12.1526491 C116.865627,11.0326448 117.607283,10.1881615 118.575244,9.61919927 C119.543205,9.05023706 120.712825,8.76575595 122.084104,8.76575595 Z M41.6411889,3.51349537 C43.4516349,3.51349537 45.0290532,3.87637678 46.3734438,4.60213961 C47.7178345,5.32790243 48.7619778,6.44566678 49.505874,7.95543265 C50.2497701,9.46519853 50.6217182,11.384886 50.6217182,13.7144951 C50.6217182,16.0441041 50.2497701,17.9637916 49.505874,19.4735575 C48.7619778,20.9833233 47.7155938,22.1010877 46.3667219,22.8268505 C45.01785,23.5526133 43.4426723,23.9154947 41.6411889,23.9154947 C39.8397054,23.9154947 38.2667684,23.5526133 36.9223778,22.8268505 C35.5779872,22.1010877 34.5316032,20.9855633 33.7832257,19.4802775 C33.0348483,17.9749916 32.6606596,16.0530642 32.6606596,13.7144951 C32.6606596,11.375926 33.0348483,9.45399848 33.7832257,7.94871263 C34.5316032,6.44342677 35.5779872,5.32790243 36.9223778,4.60213961 C38.2667684,3.87637678 39.8397054,3.51349537 41.6411889,3.51349537 Z M156.054753,8.76575595 C157.497732,8.76575595 158.687518,8.94719666 159.62411,9.31007807 C160.560702,9.67295948 161.257544,10.2822418 161.714637,11.1379252 C162.17173,11.9936085 162.400276,13.156173 162.400276,14.6256187 L162.400276,14.6256187 L162.400276,23.6573339 L159.482949,23.6573339 L159.227515,22.138608 L159.052744,22.138608 L158.898637,22.332991 C158.475071,22.8360803 157.950592,23.2170477 157.325202,23.4758932 C156.621637,23.7670943 155.862057,23.9126949 155.04646,23.9126949 C153.585555,23.9126949 152.445064,23.5341334 151.624986,22.7770105 C150.804907,22.0198875 150.394868,21.0141236 150.394868,19.7597187 C150.394868,18.4157135 150.854202,17.3651494 151.772869,16.6080265 L151.772869,16.6080265 L151.80477,16.5820386 C152.725657,15.8404901 154.196094,15.3944309 156.21608,15.2438612 L156.21608,15.2438612 L158.94512,14.9840332 L158.945193,14.4105779 L158.940794,14.168574 C158.917337,13.538938 158.800048,13.0349637 158.588929,12.6566511 C158.35142,12.2310494 157.974991,11.9308883 157.459641,11.7561676 C156.944291,11.5814469 156.274337,11.4940866 155.449777,11.4940866 C154.894096,11.4940866 154.262232,11.5433668 153.554186,11.6419271 C152.84614,11.7404875 152.15602,11.8928081 151.483825,12.0988889 L151.483825,12.0988889 L151.483825,9.39743841 L151.905694,9.27970355 C152.478584,9.13060857 153.09306,9.01305291 153.749123,8.92703658 C154.569201,8.81951616 155.337744,8.76575595 156.054753,8.76575595 Z M89.4052857,8.76855581 C90.3553217,8.76855581 91.2000472,8.95223653 91.939462,9.31959796 C92.6788769,9.68695939 93.2592055,10.2760817 93.6804479,11.0869648 C94.1016903,11.897848 94.3123115,12.9797722 94.3123115,14.3327375 L94.3123115,14.3327375 L94.3123115,23.6601337 L90.7765641,23.6601337 L90.7765641,14.5343382 L90.7727458,14.3061755 C90.7421987,13.4154738 90.528369,12.7881653 90.1312566,12.42425 C89.7010516,12.0300085 89.1095198,11.8328877 88.356661,11.8328877 C87.9981569,11.8328877 87.6262088,11.8821679 87.2408168,11.9807283 C86.8554248,12.0792887 86.4834768,12.2360893 86.1249726,12.4511301 C85.7664684,12.666171 85.4527773,12.9484121 85.1838992,13.2978534 L85.1838992,13.2978534 L85.1838992,23.6601337 L81.6481519,23.6601337 L81.6481519,8.9970367 L84.5789234,8.9970367 L84.8209137,10.5426427 L84.9956845,10.5426427 L85.2118373,10.3339019 C85.7264868,9.86154007 86.3131873,9.49207863 86.9719387,9.22551759 C87.7247974,8.92087641 88.5359131,8.76855581 89.4052857,8.76855581 Z M105.92971,3.53757561 C108.708118,3.53757561 110.789682,4.04157757 112.174405,5.04958149 C113.559127,6.05758541 114.251488,7.62783152 114.251488,9.76031982 C114.251488,11.1401652 113.922113,12.2960097 113.263361,13.2278533 C112.60461,14.1596969 111.654574,14.8608197 110.413253,15.3312215 L110.413253,15.3312215 L110.347682,15.3557623 C110.216065,15.4044096 110.081593,15.4504508 109.944266,15.4938858 L109.944266,15.4938858 L109.942568,15.4944823 L115.864757,23.6573339 L111.885361,23.6573339 L106.429325,16.0299683 L106.3726,16.0313949 C106.222471,16.0350144 106.07036,16.0368242 105.916266,16.0368242 C105.459174,16.0368242 105.051375,16.0278642 104.692871,16.0099441 C104.334367,15.9920241 103.962419,15.974104 103.577027,15.9561839 L103.577027,15.9561839 L103.577027,23.6573339 L100.041279,23.6573339 L100.041279,4.16925807 L100.471484,4.08357773 C100.908411,3.99957741 101.365504,3.9206171 101.842763,3.84669681 C102.479108,3.74813643 103.1401,3.67197613 103.825739,3.61821592 C104.511378,3.56445571 105.212702,3.53757561 105.92971,3.53757561 Z M148.571679,1.93820939 L148.571679,23.6573339 L145.035932,23.6573339 L145.035932,1.93820939 L148.571679,1.93820939 Z M158.94512,17.0575269 L156.552177,17.273309 L156.302076,17.3010778 C155.490257,17.4047476 154.896947,17.6194922 154.522147,17.9453117 C154.109868,18.3037131 153.903728,18.796515 153.903728,19.4237174 C153.903728,20.0598799 154.091942,20.5482018 154.468372,20.8886831 C154.844801,21.2291644 155.400483,21.3994051 156.135416,21.3994051 C156.619397,21.3994051 157.107859,21.3053247 157.600802,21.117164 L157.600802,21.117164 L157.649947,21.0979298 C158.123571,20.9079571 158.555319,20.6007673 158.945193,20.1763603 L158.945193,20.1763603 L158.94512,17.0575269 Z M59.0458655,11.6850472 C58.5260344,11.6850472 58.015166,11.7858476 57.5132602,11.9874483 C57.0113543,12.1890491 56.5856306,12.5138504 56.2360891,12.9618521 L56.2360891,12.9618521 L56.2360891,20.9990034 L56.4453099,21.0380635 C56.6620929,21.0758637 56.9015624,21.1098838 57.1637186,21.1401239 C57.5132602,21.1804441 57.8538391,21.2006042 58.1854555,21.2006042 C59.5836217,21.2006042 60.634487,20.8242827 61.3380515,20.0716398 C62.0416159,19.3189969 62.3933981,18.073552 62.3933981,16.3353053 C62.3933981,15.1257005 62.2499964,14.1848969 61.9631931,13.5128943 C61.6763898,12.8408917 61.2820352,12.3682498 60.7801294,12.0949688 C60.2782235,11.8216877 59.7001356,11.6850472 59.0458655,11.6850472 Z M136.248799,11.6822473 C135.728968,11.6822473 135.218099,11.7830477 134.716194,11.9846485 C134.214288,12.1862493 133.788564,12.5110505 133.439022,12.9590523 L133.439022,12.9590523 L133.439022,20.9962035 L133.648243,21.0352637 C133.865026,21.0730638 134.104496,21.107084 134.366652,21.1373241 C134.716194,21.1776442 135.056772,21.1978043 135.388389,21.1978043 C136.786555,21.1978043 137.83742,20.8214829 138.540985,20.0688399 C139.244549,19.316197 139.596331,18.0707522 139.596331,16.3325054 C139.596331,15.1229007 139.45293,14.182097 139.166126,13.5100944 C138.879323,12.8380918 138.484969,12.36545 137.983063,12.0921689 C137.481157,11.8188878 136.903069,11.6822473 136.248799,11.6822473 Z M41.6411889,6.45686682 C40.5656764,6.45686682 39.6313249,6.69206774 38.8381344,7.16246957 C38.044944,7.6328714 37.4332462,8.39447436 37.0030412,9.44727846 C36.5728362,10.5000826 36.3577338,11.895608 36.3577338,13.6338547 C36.3577338,15.4258617 36.5728362,16.8594673 37.0030412,17.9346715 C37.4332462,19.0098757 38.0427033,19.7849187 38.8314125,20.2598005 C39.6201216,20.7346824 40.5567138,20.9721233 41.6411889,20.9721233 C42.7346266,20.9721233 43.6757,20.7346824 44.4644092,20.2598005 C45.2531183,19.7849187 45.8603348,19.0210757 46.2860584,17.9682716 C46.7117821,16.9154675 46.924644,15.5244221 46.924644,13.7951354 C46.924644,12.0120884 46.7095415,10.5829629 46.2793365,9.50775869 C45.8491315,8.43255451 45.2396744,7.65527148 44.4509653,7.17590962 C43.6622561,6.69654775 42.725664,6.45686682 41.6411889,6.45686682 Z M73.7886486,11.0802448 C73.170229,11.0802448 72.6414353,11.2191253 72.2022677,11.4968864 C71.7631001,11.7746475 71.4292431,12.2405693 71.2006967,12.8946519 L71.2006967,12.8946519 L71.1862638,12.9367121 C70.9911355,13.5157762 70.8829665,14.2687091 70.8617569,15.1955109 L70.8617569,15.1955109 L70.8604326,15.2601532 L76.6225914,15.2601532 L76.6216613,15.208951 C76.6012124,14.2595442 76.4948783,13.4925912 76.3026591,12.9080919 C76.0875566,12.2540094 75.7693841,11.7858476 75.3481418,11.5036065 C74.9268994,11.2213654 74.4070683,11.0802448 73.7886486,11.0802448 Z M122.043772,11.0774449 C121.425352,11.0774449 120.896559,11.2163255 120.457391,11.4940866 C120.018223,11.7718476 119.684366,12.2377695 119.45582,12.891852 L119.45582,12.891852 L119.441387,12.9339122 C119.246259,13.5129763 119.13809,14.2659092 119.11688,15.1927111 L119.11688,15.1927111 L119.115547,15.2573534 L124.877705,15.2573534 L124.876785,15.2061511 C124.856336,14.2567444 124.750002,13.4897913 124.557782,12.9052921 C124.34268,12.2512095 124.024507,11.7830477 123.603265,11.5008066 C123.182023,11.2185655 122.662192,11.0774449 122.043772,11.0774449 Z M106.279252,6.22558607 C105.741496,6.22558607 105.259756,6.24798615 104.834032,6.29278633 C104.408308,6.3375865 103.989307,6.39582673 103.577027,6.46750701 L103.577027,6.46750701 L103.577027,13.2009732 L103.857108,13.22636 C104.039348,13.2422889 104.212625,13.2562268 104.376939,13.2681735 C104.623411,13.2860935 104.874364,13.2995336 105.129798,13.3084936 C105.385232,13.3174537 105.665313,13.3219337 105.970042,13.3219337 C107.655012,13.3219337 108.891851,13.0374526 109.68056,12.4684904 C110.469269,11.8995281 110.863624,10.9968046 110.863624,9.76031982 C110.863624,8.93599661 110.700056,8.263994 110.372921,7.74431198 C110.045786,7.22462995 109.54388,6.84158846 108.867204,6.59518751 C108.190527,6.34878655 107.327877,6.22558607 106.279252,6.22558607 Z" id="Combined-Shape" fill="#000000">
                    </path>
                  </g>
                </g>
              </g>
            </svg>
          </div>
        </a>

        <a class="nav-home-link text-gray-500 xs:-mt-2" href="https://blog.openreplay.com/">BLOG</a>   
        </div>  

        <div class="md:hidden pb-1"><iframe src="./Building a Chess Game with React_files/github-btn.html" frameborder="0" scrolling="0" width="102" height="20" title="GitHub"></iframe>
        </div>
      </div>
    
    <div class="flex-row md:flex items-center">
      <div class="inline-flex justify-center my-2">
        <div class="xs:hidden md:flex"><iframe src="./Building a Chess Game with React_files/github-btn(1).html" frameborder="0" scrolling="0" width="160px" height="30" title="GitHub"></iframe>
        </div>
      </div>
      <style>astro-island,astro-slot{display:contents}</style><script>(self.Astro=self.Astro||{}).only=t=>{(async()=>await(await t())())()},window.dispatchEvent(new Event("astro:only"));var l;{const c={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},o=(t,s)=>{if(t===""||!Array.isArray(s))return s;const[e,n]=s;return e in c?c[e](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(l=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{if(!this.hydrator||this.parentElement&&this.parentElement.closest("astro-island[ssr]"))return;const s=this.querySelectorAll("astro-slot"),e={},n=this.querySelectorAll("template[data-astro-template]");for(const r of n){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(const r of s){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("name")||"default"]=r.innerHTML)}const a=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,a,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((s,e)=>{e.disconnect(),this.childrenConnectedCallback()}).observe(this,{childList:!0})}async childrenConnectedCallback(){window.addEventListener("astro:hydrate",this.hydrate);let s=this.getAttribute("before-hydration-url");s&&await import(s),this.start()}start(){const s=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(Astro[e]===void 0){window.addEventListener(`astro:${e}`,()=>this.start(),{once:!0});return}Astro[e](async()=>{const n=this.getAttribute("renderer-url"),[a,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(const d of i.split("."))this.Component=this.Component[d]}return this.hydrator=r,this.hydrate},s,this)}attributeChangedCallback(){this.hydrator&&this.hydrate()}},l.observedAttributes=["props"],l))}</script><astro-island uid="2fiK4s" component-url="/InstantSearch.5726a5a2.js" component-export="default" renderer-url="/client.454c9b8d.js" props="{}" client="only" opts="{&quot;name&quot;:&quot;InstantSearch&quot;,&quot;value&quot;:&quot;react&quot;}"><div class="flex flex-col w-80 instant-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div></astro-island>
    </div>
  </div>
</nav>
    <main class="py-12 lg:py-20">
      <!-- Place this tag in your head or just before your close body tag. --><script async="" defer="" src="./Building a Chess Game with React_files/buttons.js.download"></script>


<div class="flex flex-col xl:flex-row mx-auto max-w-screen-xl">
  <div class="main-content w-full xl:w-9/12 justify-start mx-auto">
     <article class=" mx-auto px-3">
      <header class="mx-auto max-w-3xl text-left content">
          <a href="https://blog.openreplay.com/" class="flex items-center my-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"></path>
          </svg> Back</a>
          <h1 class="article-title">Building a Chess Game with React</h1>
              <div class="article-author astro-4737HLCA">
    <img src="./Building a Chess Game with React_files/judge-godwins.jpg" class="author-avatar astro-4737HLCA" alt="Judge Godwins">
    <a href="https://blog.openreplay.com/authors/judge-godwins" class="author-name astro-4737HLCA">Judge Godwins</a>
    <p class="astro-4737HLCA"> May 23, 2023
        · 20 min read
    </p>
</div>
      </header>
      <!-- Image -->
      <img class="rounded-xl mx-auto w-full xl:w-10/12	" style="width: 82%;" loading="lazy" src="./Building a Chess Game with React_files/hero.png" alt="Building a Chess Game with React">
      <!-- Content -->
        <section class="max-w-3xl mx-auto py-6 lg:py-12 content">
              <blockquote><p>Want to play chess? Want to learn React tricks? Want to use sockets for communication? This article will answer all three questions by building a multiplayer chess game using React and Socket.io.</p></blockquote>
<p>Chess is a timeless classic that has been enjoyed by millions of people around the world for centuries. With the rise of online gaming, it’s now possible to play chess with anyone, anywhere, at any time. In this article, we’ll explore how to build a multiplayer chess game using <a href="https://github.com/jhlywa/chess.js/blob/master/README.md">chess.js</a>, <a href="https://www.npmjs.com/package/react-chessboard">react-chessboard</a>, and <a href="https://socket.io/">socket.io</a>. These powerful libraries will allow us to create a fast and responsive chess game with real-time multiplayer functionality. So, whether you’re an experienced chess player or just looking for a fun project to work on, let’s dive in and build our very own multiplayer chess game!</p>
<p>Here’s a breakdown of the libraries that will be used in this project:</p>
<ul>
<li><a href="https://www.npmjs.com/package/react-chessboard">react-chessboard</a>: For rendering the chess board.</li>
<li><a href="https://github.com/jhlywa/chess.js/blob/master/README.md">chess.js</a> library: For move generation and validation.</li>
<li><a href="https://socket.io/">socket.io</a>: for websocket connection and multiplayer connectivity.</li>
<li><a href="https://mui.com/">Material UI</a>: For building the app UI.</li>
</ul>
<h2 id="project-structure">Project Structure</h2>
<p>In this project, we’ll make use of two directories. One for the client application and the other for the server. Here’s what the project directory structure looks like:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#c9d1d9">multiplayer-chess</span></span>
<span class="line"><span style="color:#c9d1d9">|--client</span></span>
<span class="line"><span style="color:#c9d1d9">|--server</span></span></code></pre>
<p>Create the <code>client</code> and <code>server</code> directories. You can find the code for this project <a href="https://github.com/judgegodwins/multiplayer-chess">here</a>.</p>
<h2 id="building-the-client-application">Building the Client Application</h2>
<p>Let’s create a new React app in the <code>client</code> directory. To do this, change into the <code>client</code> directory and run the following:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">npx create-react-app </span><span style="color:#79C0FF">.</span></span></code></pre>
<p>Next, let’s install the required dependencies for the client. In the client directory, run the following:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">npm install react-chessboard chess.js socket.io-client @mui/material @emotion/react @emotion/styled</span></span>
<span class="line"></span></code></pre>
<p><a href="https://www.npmjs.com/package/@mui/material"><code>@mui/material</code></a>, <a href="https://www.npmjs.com/package/@emotion/react"><code>@emotion/react</code></a> and <a href="https://www.npmjs.com/package/@emotion/styled"><code>@emotion/styled</code></a> are required to setup material UI.</p>
<p>After installing the required dependencies, delete all files in the <code>src</code> directory <strong>except <code>index.js</code> and <code>App.js</code></strong>. Edit the <code>index.js</code> file to contain the following:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> React </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"react"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> ReactDOM </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"react-dom/client"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> App </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"./App"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">root</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ReactDOM.</span><span style="color:#D2A8FF">createRoot</span><span style="color:#C9D1D9">(document.</span><span style="color:#D2A8FF">getElementById</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"root"</span><span style="color:#C9D1D9">));</span></span>
<span class="line"><span style="color:#C9D1D9">root.</span><span style="color:#D2A8FF">render</span><span style="color:#C9D1D9">(&lt;</span><span style="color:#7EE787">App</span><span style="color:#C9D1D9"> /&gt;);</span></span></code></pre>
<p>Also, let’s edit the <code>App.js</code> file to contain the following:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { Container } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"@mui/material"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> Game </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"./Game"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">export</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">default</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">function</span><span style="color:#FFA657"> </span><span style="color:#D2A8FF">App</span><span style="color:#FFA657">() </span><span style="color:#C9D1D9">{</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">Container</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">Game</span><span style="color:#C9D1D9"> /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">Container</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span></code></pre>
<p>If you noticed, we are importing a Game.js file that hasn’t been created yet. This <code>Game</code> component will contain the core logic of our application.</p>
<p>We’ll create the <code>Game</code> component, but before that, let’s create a reusable modal/dialog component (based on Material UI) that will be used in various sections of the app. Create a new directory called <code>components</code>, then create a new file called <code>CustomDialog.js</code> in the <code>components</code> directory. Add the following content to CustomDialog.js:</p>
<p><code>src/components/CustomDialog.js</code></p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> Button </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"@mui/material/Button"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> Dialog </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"@mui/material/Dialog"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> DialogActions </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"@mui/material/DialogActions"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> DialogContent </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"@mui/material/DialogContent"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> DialogContentText </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"@mui/material/DialogContentText"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> DialogTitle </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"@mui/material/DialogTitle"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">export</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">default</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">function</span><span style="color:#FFA657"> </span><span style="color:#D2A8FF">CustomDialog</span><span style="color:#FFA657">({ open, children, title, contentText, handleContinue }) </span><span style="color:#C9D1D9">{</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">Dialog</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">open</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">open</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&gt; </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/*dialog container*/</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">DialogTitle</span><span style="color:#C9D1D9">&gt;</span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">title</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&lt;/</span><span style="color:#7EE787">DialogTitle</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">DialogContent</span><span style="color:#C9D1D9">&gt; </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/* Main body of modal/dialog */</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">DialogContentText</span><span style="color:#C9D1D9">&gt; </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/* main text */</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">contentText</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;/</span><span style="color:#7EE787">DialogContentText</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">children</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/* Other content */</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">DialogContent</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">DialogActions</span><span style="color:#C9D1D9">&gt; </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/* Dialog action buttons */</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/* Force users to make input without option to cancel */</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/* &lt;Button onClick={handleClose}&gt;Cancel&lt;/Button&gt; */</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">Button</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">onClick</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">handleContinue</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&gt;Continue&lt;/</span><span style="color:#7EE787">Button</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">DialogActions</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">Dialog</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span></code></pre>
<p>The props of the <code>CustomDialog</code> component include:</p>
<ul>
<li><code>open</code>: Boolean value to determine if the dialog should be rendered or not.</li>
<li><code>children</code>: Prop to get the component’s children. Children elements are rendered in the dialog content.</li>
<li><code>title</code>: Title of the dialog.</li>
<li><code>contentText</code>: Message to be displayed in the dialog.</li>
<li><code>handleContinue</code>: Function to be called when the “continue button” is clicked.</li>
</ul>
<p>Now, let’s create the Game component. Create a <code>Game.js</code> file in the <code>src</code> directory and add the following content:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { useState, useMemo, useCallback, useEffect } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"react"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { Chessboard } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"react-chessboard"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { Chess } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"chess.js"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> CustomDialog </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"./components/CustomDialog"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">function</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Game</span><span style="color:#C9D1D9">({ </span><span style="color:#FFA657">players</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">room</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">orientation</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">cleanup</span><span style="color:#C9D1D9"> }) {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">chess</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useMemo</span><span style="color:#C9D1D9">(() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">new</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Chess</span><span style="color:#C9D1D9">(), []); </span><span style="color:#8B949E">// &lt;- 1</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">fen</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setFen</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">(chess.</span><span style="color:#D2A8FF">fen</span><span style="color:#C9D1D9">()); </span><span style="color:#8B949E">// &lt;- 2</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">over</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setOver</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">""</span><span style="color:#C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// onDrop function</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">function</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">onDrop</span><span style="color:#C9D1D9">() {} </span><span style="color:#8B949E">// &lt;- 3</span></span>
<span class="line"><span style="color:#C9D1D9">  </span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// Game component returned jsx</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"board"</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">Chessboard</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">position</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">fen</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">onPieceDrop</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">onDrop</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9"> /&gt;  </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/**  &lt;- 4 */</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">CustomDialog</span><span style="color:#C9D1D9"> </span><span style="color:#8B949E">// &lt;- 5</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">open</span><span style="color:#FF7B72">={</span><span style="color:#D2A8FF">Boolean</span><span style="color:#C9D1D9">(over)</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">title</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">over</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">contentText</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">over</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">handleContinue</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#D2A8FF">setOver</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">""</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">        }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">export</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">default</span><span style="color:#FFA657"> </span><span style="color:#C9D1D9">Game;</span></span></code></pre>
<p>Below is a breakdown of the code above. Notice the line-number comments in the code above; each line-number comment corresponds to a numbered line below.</p>
<ol>
<li>We created a memoized <code>Chess</code> instance with 0 dependencies. The <code>useMemo</code> hook lets us cache the chess instance between re-renders so that the instance is not created on every re-render. This <code>Chess</code> instance will be used for move validation and generation.</li>
<li>We set the initial <code>fen</code> state to the FEN (Forsyth-Edwards Notation) returned from the <code>Chess</code> instance. FEN is a standard notation to describe the positions of a chess game.</li>
<li>We created an empty <code>onDrop</code> function</li>
<li>We set up the chessboard using the <code>Chessboard</code> component from <code>react-chessboard</code> and passed the FEN notation (<code>fen</code>) to the <code>position</code> prop, as well as passed the <code>onDrop</code> function to the <code>onPieceDrop prop</code>. The <code>onPieceDrop</code> function prop is called every time a piece is moved.</li>
<li>We created a dialog component that will be rendered when the state <code>over</code> is truthy. <code>over</code> will contain a text that describes the reason the game is over. This may be a checkmate or a stalemate/draw.</li>
</ol>
<p>You can start the app by running <code>npm start</code> on your terminal (in the <code>client</code> directory). You’ll find a chessboard displayed.</p>
<p><img src="./Building a Chess Game with React_files/NntgKgb.png" alt="-"></p>
<p>We are not yet handling piece movements. Let’s fix that. Let’s complete the <code>onDrop</code> function in the <code>Game</code> component:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// onDrop function</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">function</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">onDrop</span><span style="color:#C9D1D9">(</span><span style="color:#FFA657">sourceSquare</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">targetSquare</span><span style="color:#C9D1D9">) {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">moveData</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      from: sourceSquare,</span></span>
<span class="line"><span style="color:#C9D1D9">      to: targetSquare,</span></span>
<span class="line"><span style="color:#C9D1D9">      color: chess.</span><span style="color:#D2A8FF">turn</span><span style="color:#C9D1D9">(),</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#8B949E">// promotion: "q",</span></span>
<span class="line"><span style="color:#C9D1D9">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">move</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">makeAMove</span><span style="color:#C9D1D9">(moveData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// illegal move</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (move </span><span style="color:#FF7B72">===</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">null</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">false</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">true</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">  }</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// ...</span></span></code></pre>
<p>In the code above, we created the <code>onDrop</code> function that receives two function parameters <code>sourceSquare</code> (the initial piece position) and <code>targetSquare</code>(target position). Inside the function, we constructed a <code>moveData</code> object using <code>sourceSquare</code>, <code>targetSquare</code>, and <code>color</code>, which is set to <code>chess.turn()</code> (<code>chess.turn()</code> returns the color of the current side set to play, either <code>'b'</code> or <code>'w'</code>). Then we call <code>makeAMove</code>(not defined yet). This function will pass <code>moveData</code> to the <code>Chess</code> instance for validation and generation. We return true or false depending on the returned value of <code>makeAMove</code>.</p>
<p>Now let’s create the <code>makeAMove</code> function. Add the following to the <code>Game</code> component, just above the <code>onDrop</code> function.</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">makeAMove</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useCallback</span><span style="color:#C9D1D9">(</span></span>
<span class="line"><span style="color:#C9D1D9">  (</span><span style="color:#FFA657">move</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">try</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">result</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> chess.</span><span style="color:#D2A8FF">move</span><span style="color:#C9D1D9">(move); </span><span style="color:#8B949E">// update Chess instance</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#D2A8FF">setFen</span><span style="color:#C9D1D9">(chess.</span><span style="color:#D2A8FF">fen</span><span style="color:#C9D1D9">()); </span><span style="color:#8B949E">// update fen state to trigger a re-render</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">      console.</span><span style="color:#D2A8FF">log</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"over, checkmate"</span><span style="color:#C9D1D9">, chess.</span><span style="color:#D2A8FF">isGameOver</span><span style="color:#C9D1D9">(), chess.</span><span style="color:#D2A8FF">isCheckmate</span><span style="color:#C9D1D9">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (chess.</span><span style="color:#D2A8FF">isGameOver</span><span style="color:#C9D1D9">()) { </span><span style="color:#8B949E">// check if move led to "game over"</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (chess.</span><span style="color:#D2A8FF">isCheckmate</span><span style="color:#C9D1D9">()) { </span><span style="color:#8B949E">// if reason for game over is a checkmate</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#8B949E">// Set message to checkmate. </span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#D2A8FF">setOver</span><span style="color:#C9D1D9">(</span></span>
<span class="line"><span style="color:#C9D1D9">            </span><span style="color:#A5D6FF">`Checkmate! ${</span><span style="color:#C9D1D9">chess</span><span style="color:#A5D6FF">.</span><span style="color:#D2A8FF">turn</span><span style="color:#A5D6FF">() </span><span style="color:#FF7B72">===</span><span style="color:#A5D6FF"> </span><span style="color:#A5D6FF">"w"</span><span style="color:#A5D6FF"> </span><span style="color:#FF7B72">?</span><span style="color:#A5D6FF"> </span><span style="color:#A5D6FF">"black"</span><span style="color:#A5D6FF"> </span><span style="color:#FF7B72">:</span><span style="color:#A5D6FF"> </span><span style="color:#A5D6FF">"white"} wins!`</span></span>
<span class="line"><span style="color:#C9D1D9">          ); </span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#8B949E">// The winner is determined by checking which side made the last move</span></span>
<span class="line"><span style="color:#C9D1D9">        } </span><span style="color:#FF7B72">else</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (chess.</span><span style="color:#D2A8FF">isDraw</span><span style="color:#C9D1D9">()) { </span><span style="color:#8B949E">// if it is a draw</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#D2A8FF">setOver</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"Draw"</span><span style="color:#C9D1D9">); </span><span style="color:#8B949E">// set message to "Draw"</span></span>
<span class="line"><span style="color:#C9D1D9">        } </span><span style="color:#FF7B72">else</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#D2A8FF">setOver</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"Game over"</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">        }</span></span>
<span class="line"><span style="color:#C9D1D9">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> result;</span></span>
<span class="line"><span style="color:#C9D1D9">    } </span><span style="color:#FF7B72">catch</span><span style="color:#C9D1D9"> (e) {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">null</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">    } </span><span style="color:#8B949E">// null if the move was illegal, the move object if the move was legal</span></span>
<span class="line"><span style="color:#C9D1D9">  },</span></span>
<span class="line"><span style="color:#C9D1D9">  [chess]</span></span>
<span class="line"><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#8B949E">// ...</span></span></code></pre>
<p>In the code above:</p>
<ul>
<li>We created the <code>makeAMove</code> function using a <code>useCallback</code> hook with <code>chess</code> as a dependency in order to cache the function definition between re-renders and avoid creating the function on every re-render.</li>
<li>The <code>makeAMove</code> function accepts a move and calls <code>chess.move</code> with a <code>move</code> object as an argument. This method (<code>.move</code>) validates the move and updates the <code>Chess</code> instance’s internal state. Next, we set the <code>Game</code> component’s <code>fen</code> state to reflect that of the <code>Chess</code> instance. This triggers a re-render and updates the chessboard.</li>
<li>After the move is made, we check if it resulted in a ‘game over’. If this is true, we determine if it was due to a checkmate or a draw and update the game’s state accordingly with an appropriate message.</li>
<li>The <code>makeAMove</code> function body is wrapped in a try…catch block because calling <code>chess.move</code> with an illegal move object throws an error. When an error is thrown, we simply return <code>null</code>. The null return value is handled in the <code>onDrop</code> function, as discussed earlier.</li>
</ul>
<p>You can open the app in your browser and play as both sides. Ensure that the app is running by executing <code>npm start</code> in the <code>client</code> directory, and try to achieve a checkmate.</p>
<p><img src="./Building a Chess Game with React_files/OAn6Ys5.gif" alt="-"></p>
<p>We have developed a web-based chess application that allows two players to play against each other on the same computer. Now, it’s time to set up the backend server to enable multiplayer connectivity and allow players to compete with each other over the internet.</p>
<h2 id="setting-up-the-backend">Setting up the Backend</h2>
<p>To enable multiplayer connectivity, we’ll need a backend server. Let’s create an HTTP and websocket server using ExpressJS and Socket.io.</p>
<ul>
<li>
<p>Express is a minimal and flexible Node.js web application framework that offers a comprehensive set of features for building web applications. With Express, you can effortlessly set up an HTTP server in a Node.js environment.</p>
</li>
<li>
<p>Socket.io is a framework that offers a straightforward API for creating a WebSocket server to facilitate WebSocket connections. WebSocket connections provide a two-way communication channel between the client and server, where both sides can send and receive messages within a single TCP connection. WebSocket connections are established over HTTP connections through a process of upgrading the connection.</p>
</li>
</ul>
<p>First, let’s initialize the project and install its dependencies. Open a terminal in the <code>server</code> directory and execute the following command:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">npm init -y</span></span></code></pre>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">npm install express socket.io uuid</span></span></code></pre>
<p>Install Nodemon as a development dependency. Nodemon automatically restarts the server whenever changes are made. Execute the following command in the terminal:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">npm install nodemon --save-dev</span></span></code></pre>
<p>To use Nodemon in the <code>npm start</code> command, include the start command in the <code>package.json</code> file as follows:”</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">{</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#7EE787">"scripts"</span><span style="color:#C9D1D9">: {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#7EE787">"start"</span><span style="color:#C9D1D9">: </span><span style="color:#A5D6FF">"nodemon server.js"</span></span>
<span class="line"><span style="color:#C9D1D9">  }</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span></code></pre>
<p>Create a new file named <code>server.js</code> in the server directory, and add the following code to set up an Express and Socket.io server:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">express</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">require</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'express'</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> { </span><span style="color:#79C0FF">Server</span><span style="color:#C9D1D9"> } </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">require</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"socket.io"</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> { </span><span style="color:#FFA657">v4</span><span style="color:#C9D1D9">: </span><span style="color:#79C0FF">uuidV4</span><span style="color:#C9D1D9"> } </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">require</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'uuid'</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">http</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">require</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'http'</span><span style="color:#C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">app</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">express</span><span style="color:#C9D1D9">(); </span><span style="color:#8B949E">// initialize express</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">server</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> http.</span><span style="color:#D2A8FF">createServer</span><span style="color:#C9D1D9">(app);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E">// set port to value received from environment variable or 8080 if null</span></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">port</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> process.env.</span><span style="color:#79C0FF">PORT</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">||</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">8080</span><span style="color:#C9D1D9"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E">// upgrade http server to websocket server</span></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">io</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">new</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Server</span><span style="color:#C9D1D9">(server, {</span></span>
<span class="line"><span style="color:#C9D1D9">  cors: </span><span style="color:#A5D6FF">'*'</span><span style="color:#C9D1D9">, </span><span style="color:#8B949E">// allow connection from any origin</span></span>
<span class="line"><span style="color:#C9D1D9">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E">// io.connection</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">server.</span><span style="color:#D2A8FF">listen</span><span style="color:#C9D1D9">(port, () </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  console.</span><span style="color:#D2A8FF">log</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">`listening on *:${</span><span style="color:#C9D1D9">port</span><span style="color:#A5D6FF">}`</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">});</span></span></code></pre>
<p>The code above initializes an Express server and creates a WebSocket server using the socket.io library. Here’s a breakdown of the code above:</p>
<ul>
<li>The necessary libraries (<code>express</code>, <code>socket.io</code>, <code>http</code> and <a href="https://www.npmjs.com/package/uuid"><code>uuid</code></a>) are imported.</li>
<li>An Express application is initialized by calling the <code>express()</code> function, then, an HTTP server is created using the <code>http.createServer()</code> function with the express application (<code>app</code>) passed as an argument.</li>
<li>The code sets the port to a value received from an environment variable using <code>process.env.PORT</code> or defaults to <code>8080</code> if the environment variable is not set.</li>
<li>Next, it creates a WebSocket server by calling the <code>new Server()</code> constructor function from the socket.io library, passing in the HTTP server, and setting the <code>cors</code> option to allow connections from any origin.</li>
<li>Finally, the server listens on the specified port using the <code>server.listen()</code> function and logs a message to the console to indicate that it is listening for incoming connections.</li>
</ul>
<p>After setting up the HTTP and WebSocket servers, we need to listen for incoming WebSocket connections on the WebSocket server. Add the following listener to server.js, just below the <code>io</code> server definition:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#8B949E">// io.connection</span></span>
<span class="line"><span style="color:#C9D1D9">io.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'connection'</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">socket</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// socket refers to the client socket that just got connected.</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// each socket is assigned an id</span></span>
<span class="line"><span style="color:#C9D1D9">  console.</span><span style="color:#D2A8FF">log</span><span style="color:#C9D1D9">(socket.id, </span><span style="color:#A5D6FF">'connected'</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">});</span></span></code></pre>
<p>Run <code>npm start</code> in the terminal to start the server. You can also run <code>node server.js</code>, but this will not restart the server whenever changes are made. You should see a message <code>listening on *:8080</code>.</p>
<h2 id="implementing-multiplayer-functionality">Implementing Multiplayer Functionality</h2>
<p>To establish a WebSocket connection on the client, we need to enable it. We previously installed the <code>socket.io-client</code> package, and we’ll use the <code>io</code> function from this package to connect to the Socket.io server.</p>
<p>Switch to the <code>client</code> directory. In the <code>src</code> folder, create a new file called <code>socket.js</code> and add the following content:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { io } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"socket.io-client"</span><span style="color:#C9D1D9">; </span><span style="color:#8B949E">// import connection function</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">socket</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">io</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'localhost:8080'</span><span style="color:#C9D1D9">); </span><span style="color:#8B949E">// initialize websocket connection</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">export</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">default</span><span style="color:#FFA657"> </span><span style="color:#C9D1D9">socket;</span></span></code></pre>
<p>From the code above, the <code>io</code> function is imported from <code>socket.io-client</code>. Then, the <code>io</code> function is called with the server address as a function argument, which initiates the WebSocket connection.</p>
<p>Each connected user needs to have an associated username. For simplicity, we will obtain a user’s desired username whenever the app is launched by making use of a dialog that contains a text field to accept user input.</p>
<p>When a username has been selected, the username retrieved from the user will be stored in a state in the <code>App</code> component. Then, a WebSocket event named <code>username</code> carrying the selected username as event data will be emitted to the server via the WebSocket connection. When the <code>username</code> event is received on the backend server, the username which was sent as event data will be attached to the client’s socket data.</p>
<p>Edit <code>client/src/App.js</code> to contain the following content:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { useState } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"react"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { Container, TextField } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"@mui/material"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> Game </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"./Game"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> socket </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">'./socket'</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> CustomDialog </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"./components/CustomDialog"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">export</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">default</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">function</span><span style="color:#FFA657"> </span><span style="color:#D2A8FF">App</span><span style="color:#FFA657">() </span><span style="color:#C9D1D9">{</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">username</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setUsername</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">''</span><span style="color:#C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// indicates if a username has been submitted</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">usernameSubmitted</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setUsernameSubmitted</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">false</span><span style="color:#C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">Container</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">CustomDialog</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">open</span><span style="color:#FF7B72">={!</span><span style="color:#C9D1D9">usernameSubmitted</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9"> </span><span style="color:#8B949E">// leave open if username has not been selected</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">title</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"Pick a username"</span><span style="color:#C9D1D9"> </span><span style="color:#8B949E">// Title of dialog</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">contentText</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"Please select a username"</span><span style="color:#C9D1D9"> </span><span style="color:#8B949E">// content text of dialog</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">handleContinue</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> { </span><span style="color:#8B949E">// fired when continue is clicked</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (</span><span style="color:#FF7B72">!</span><span style="color:#C9D1D9">username) </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9">; </span><span style="color:#8B949E">// if username hasn't been entered, do nothing</span></span>
<span class="line"><span style="color:#C9D1D9">          socket.</span><span style="color:#D2A8FF">emit</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"username"</span><span style="color:#C9D1D9">, username); </span><span style="color:#8B949E">// emit a websocket event called "username" with the username as data</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#D2A8FF">setUsernameSubmitted</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">true</span><span style="color:#C9D1D9">); </span><span style="color:#8B949E">// indicate that username has been submitted</span></span>
<span class="line"><span style="color:#C9D1D9">        }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">TextField</span><span style="color:#C9D1D9"> </span><span style="color:#8B949E">// Input</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">autoFocus</span><span style="color:#C9D1D9"> </span><span style="color:#8B949E">// automatically set focus on input (make it active).</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">margin</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"dense"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">id</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"username"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">label</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"Username"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">name</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"username"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">value</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">username</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">required</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">onChange</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">(</span><span style="color:#FFA657">e</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">setUsername</span><span style="color:#C9D1D9">(e.target.value)</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9"> </span><span style="color:#8B949E">// update username state with value</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">type</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"text"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">fullWidth</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">variant</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"standard"</span></span>
<span class="line"><span style="color:#C9D1D9">        /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">CustomDialog</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">Game</span><span style="color:#C9D1D9"> /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">Container</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span></code></pre>
<p>Go through the comments for an explanation of what’s going on.</p>
<p>Make sure the backend server is already running (run <code>npm start</code> in the <code>server</code> directory on your terminal). Start the client app (if it isn’t running) by executing <code>npm start</code> in the <code>client</code> directory on your terminal. On your browser, you should see the dialog popup asking for a username.</p>
<p><img src="./Building a Chess Game with React_files/KzakQjz.png" alt="-"></p>
<p>You should also see a message in the server’s logs similar to this:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">Q9uuNsmiSDiHMOCkAAAC connected</span></span></code></pre>
<p>The first item in the log message is the socket ID. You can see this log because the <code>socket.js</code> has been imported into <code>App.js</code> and a WebSocket connection has been initiated.</p>
<p>Now we have to add a WebSocket event listener on the backend to listen to the <code>username</code> event and retrieve the username data from the client. This data will be attached to the client’s socket instance.</p>
<p>In the <code>server</code> directory, open <code>server.js</code> and add the socket event listener inside the callback function of <code>io.on('connection')</code> as shown below:</p>
<p><code>server/server.js</code></p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#8B949E">// io.connection</span></span>
<span class="line"><span style="color:#C9D1D9">io.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'connection'</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">socket</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// socket refers to the client socket that just got connected.</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// each socket is assigned an id</span></span>
<span class="line"><span style="color:#C9D1D9">  console.</span><span style="color:#D2A8FF">log</span><span style="color:#C9D1D9">(socket.id, </span><span style="color:#A5D6FF">'connected'</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// listen to username event</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  socket.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'username'</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">username</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    console.</span><span style="color:#D2A8FF">log</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'username:'</span><span style="color:#C9D1D9">, username);</span></span>
<span class="line"><span style="color:#C9D1D9">    socket.data.username </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> username;</span></span>
<span class="line"><span style="color:#C9D1D9">  });</span></span>
<span class="line"><span style="color:#C9D1D9">});</span></span>
<span class="line"><span style="color:#8B949E">// ...</span></span></code></pre>
<p>When you enter a username in the dialog box on the client app and click on ‘continue’, the server should receive the “username” event and data. You’ll find a log in the terminal similar to this:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">username: judge</span></span></code></pre>
<h2 id="initializing-a-game">Initializing a Game</h2>
<p>Let’s now create a component that will allow users to start or join a game. We’ll be making use of the concept of rooms. Think of it as a literal room that users can join and leave. When there are users in a room, any message emitted to that room will be received by all users in that room.</p>
<p>In our application, the two players in a game will be in a socket room. Events emitted to that room will be received by both players.</p>
<p>Let’s create a new component called <code>InitGame</code>. This component will be responsible for initializing a game. Through this component, a user can either create or join a game room.  Create a new file called <code>InitGame.js</code> in the client’s <code>src</code> directory and add the following:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { Button, Stack, TextField } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"@mui/material"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { useState } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"react"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> CustomDialog </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"./components/CustomDialog"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> socket </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">'./socket'</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">export</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">default</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">function</span><span style="color:#FFA657"> </span><span style="color:#D2A8FF">InitGame</span><span style="color:#FFA657">({ setRoom, setOrientation, setPlayers }) </span><span style="color:#C9D1D9">{</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">roomDialogOpen</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setRoomDialogOpen</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">false</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">roomInput</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setRoomInput</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">''</span><span style="color:#C9D1D9">); </span><span style="color:#8B949E">// input state</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">roomError</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setRoomError</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">''</span><span style="color:#C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">Stack</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">justifyContent</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"center"</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">alignItems</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"center"</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">sx</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">{ py: </span><span style="color:#79C0FF">1</span><span style="color:#C9D1D9">, height: </span><span style="color:#A5D6FF">"100vh"</span><span style="color:#C9D1D9"> }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">CustomDialog</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">open</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">roomDialogOpen</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">handleClose</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">setRoomDialogOpen</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">false</span><span style="color:#C9D1D9">)</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">title</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"Select Room to Join"</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">contentText</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"Enter a valid room ID to join the room"</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">handleContinue</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#8B949E">// join a room</span></span>
<span class="line"><span style="color:#C9D1D9">        }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">TextField</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">autoFocus</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">margin</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"dense"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">id</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"room"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">label</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"Room ID"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">name</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"room"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">value</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">roomInput</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">required</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">onChange</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">(</span><span style="color:#FFA657">e</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">setRoomInput</span><span style="color:#C9D1D9">(e.target.value)</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">type</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"text"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">fullWidth</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">variant</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"standard"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">error</span><span style="color:#FF7B72">={</span><span style="color:#D2A8FF">Boolean</span><span style="color:#C9D1D9">(roomError)</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">helperText</span><span style="color:#FF7B72">={!</span><span style="color:#C9D1D9">roomError </span><span style="color:#FF7B72">?</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">'Enter a room ID'</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">:</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">`Invalid room ID: ${</span><span style="color:#C9D1D9">roomError</span><span style="color:#A5D6FF">}`</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">CustomDialog</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/* Button for starting a game */</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">Button</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">variant</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"contained"</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">onClick</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#8B949E">// create a room</span></span>
<span class="line"><span style="color:#C9D1D9">        }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        Start a game</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">Button</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/* Button for joining a game */</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">Button</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">onClick</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#D2A8FF">setRoomDialogOpen</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">true</span><span style="color:#C9D1D9">)</span></span>
<span class="line"><span style="color:#C9D1D9">        }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        Join a game</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">Button</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">Stack</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span></code></pre>
<p>Explanation of the code above:</p>
<ul>
<li>We created a new component called <code>InitGame</code>.</li>
<li><code>InitGame</code> has three states:
<ul>
<li><code>roomDialogOpen</code>:  This is a boolean state that determines if the <code>CustomDialog</code> should be rendered. The dialog contains a text field that allows the user to enter the ID of a room they’d like to join.</li>
<li><code>roomInput</code>: This state enables the component to control the text input. It will contain the room ID the user has provided.</li>
<li><code>roomError</code>: This state keeps track of whatever error was encountered while trying to join a room.</li>
</ul>
</li>
<li>Material UI’s Stack component is used to wrap other elements. A stack component is simply a css flex component with a default <code>flex-direction</code> property of <code>'column'</code></li>
<li>We created a dialog that contains a text field that’ll enable a user to enter a room ID they’d like to join.</li>
<li>There are two action buttons. One to start a new game and another to join a game using the room ID. The button to join a game simply causes the dialog to pop up. All “room-joining” actions will be performed in the dialog</li>
<li>The props (<code>setRoom</code>, <code>setOrientation</code>, <code>setPlayers</code>) are functions to update the app state. We’ll see how these work.</li>
</ul>
<!--
<div class="p-5 bg-slate-100 rounded-md">
<h3>Session Replay for Developers</h3> 
<p class="text-slate-800">
Uncover frustrations, understand bugs and fix slowdowns like never before with <strong><a href="https://github.com/openreplay/openreplay" target="_blank">OpenReplay</a></strong> — an open-source session replay suite for developers. It can be <strong>self-hosted</strong> in minutes, giving you complete control over your customer data </p>
<Image class="my-4" src="https://raw.githubusercontent.com/openreplay/openreplay/main/static/overview.png" alt="OpenReplay" width={768} height={400}/>
<p class="text-slate-800">Happy debugging! <a href="https://openreplay.com" target="_blank">Try using OpenReplay today.</a></p>
</div>
 --><!-- <p>
  <a href="https://newsletter.openreplay.com/" target="_blank">
    <Image src="/images/newsletter.png" alt="newsletter" width={1450} height={226}/>
  </a>
</p> --><!--
  This is put here as backup from header.dev.to.tx  
  [![newsletter](https://blog.openreplay.com/newsletter_Z1P0UIP.png)](https://newsletter.openreplay.com/)  
--><div class="p-5 bg-gradient-to-t from-violet-100 from-90% to-blue-50 to-180% justify-center rounded-md post-mid-cta" style="background-color: #F1F5F9 !important; border-radius: 5px; padding:1.2rem">
  <h3>Session Replay for Developers</h3> 
  <p>
  Uncover frustrations, understand bugs and fix slowdowns like never before with <a href="https://github.com/openreplay/openreplay" target="_blank" class="font-bold inline-block">OpenReplay</a> — an open-source session replay tool for developers. Self-host it in minutes, and have complete control over your customer data. 
      <a class="post-end-cta-git font-bold  hover:text-underline inline-flex items-baseline gap-1" href="https://github.com/openreplay/openreplay" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
        Check our GitHub repo
      </a> and join the thousands of developers in our community. <iframe src="./Building a Chess Game with React_files/github-btn(2).html" frameborder="0" scrolling="0" width="160px" height="30" title="GitHub" class="inline-block align-text-top"></iframe>
    </p>
    
    </div>
  

<h2 id="creating-and-joining-game-rooms">Creating and Joining Game Rooms</h2>
<p>To implement room creation on the client side, we need to update the <code>onclick</code> function of the button that starts a game. This function will emit a WebSocket event called <code>createRoom</code>. We will also update the socket.io server to listen to this event and create a new room.</p>
<p>Update the <code>onclick</code> prop of the “Start a game” button in the <code>InitGame</code> component, as shown below:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">&lt;</span><span style="color:#7EE787">Button</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#79C0FF">variant</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"contained"</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#79C0FF">onClick</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    socket.</span><span style="color:#D2A8FF">emit</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"createRoom"</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">r</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      console.</span><span style="color:#D2A8FF">log</span><span style="color:#C9D1D9">(r);</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#D2A8FF">setRoom</span><span style="color:#C9D1D9">(r);</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#D2A8FF">setOrientation</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"white"</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">    });</span></span>
<span class="line"><span style="color:#C9D1D9">  }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  Start a game</span></span>
<span class="line"><span style="color:#C9D1D9">&lt;/</span><span style="color:#7EE787">Button</span><span style="color:#C9D1D9">&gt;</span></span></code></pre>
<p>In the <code>onclick</code> function, we emit a <code>createRoom</code> event through the WebSocket connection, and this time, we make use of a callback. We use a callback because it will be called on the backend and passed a <code>roomId</code> argument. This callback function is a way of receiving a response from the server. The value of the response <code>r</code> will be the room’s ID. In the callback function, we update the room state (by calling <code>setRoom</code>) with the value of the room ID and also set the orientation/side to white (so a player who creates a room plays the white side by default).</p>
<p>On the server, we have to listen to this <code>createRoom</code> event and handle the creation of rooms.</p>
<p>Before adding an event listener for the <code>createRoom</code> event, we need a data structure to store the rooms’ data. A room’s data will include a room ID and a list of players in the room. For simplicity, we’ll be making use of a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map">Javascript Map</a>. If you intend to build for production, consider making use of a database like Redis to store room data and game state.</p>
<p>In the <code>server/server.js</code> file, create a new <code>rooms</code> constant above the <code>io.on('connection')</code> function and assign it a <code>Map</code> object.</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">rooms</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">new</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Map</span><span style="color:#C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E">// io.on('connection')</span></span>
<span class="line"><span style="color:#8B949E">// ...</span></span></code></pre>
<p>Then, update the callback function of <code>io.on('connection')</code> by adding a new <code>createRoom</code> event listener just below the <code>username</code> event listener, as shown below:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#8B949E">// io.on('connection');</span></span>
<span class="line"><span style="color:#C9D1D9">io.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'connection'</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">socket</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  console.</span><span style="color:#D2A8FF">log</span><span style="color:#C9D1D9">(socket.id, </span><span style="color:#A5D6FF">'connected'</span><span style="color:#C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// socket.on('username')</span></span>
<span class="line"><span style="color:#C9D1D9">  socket.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'username'</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">username</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    console.</span><span style="color:#D2A8FF">log</span><span style="color:#C9D1D9">(username);  </span></span>
<span class="line"><span style="color:#C9D1D9">    socket.data.username </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> username;</span></span>
<span class="line"><span style="color:#C9D1D9">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// createRoom</span></span>
<span class="line"><span style="color:#C9D1D9">  socket.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'createRoom'</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">async</span><span style="color:#C9D1D9"> (</span><span style="color:#FFA657">callback</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> { </span><span style="color:#8B949E">// callback here refers to the callback function from the client passed as data</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">roomId</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">uuidV4</span><span style="color:#C9D1D9">(); </span><span style="color:#8B949E">// &lt;- 1 create a new uuid</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">await</span><span style="color:#C9D1D9"> socket.</span><span style="color:#D2A8FF">join</span><span style="color:#C9D1D9">(roomId); </span><span style="color:#8B949E">// &lt;- 2 make creating user join the room</span></span>
<span class="line"><span style="color:#C9D1D9">   </span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// set roomId as a key and roomData including players as value in the map</span></span>
<span class="line"><span style="color:#C9D1D9">    rooms.</span><span style="color:#D2A8FF">set</span><span style="color:#C9D1D9">(roomId, { </span><span style="color:#8B949E">// &lt;- 3</span></span>
<span class="line"><span style="color:#C9D1D9">      roomId,</span></span>
<span class="line"><span style="color:#C9D1D9">      players: [{ id: socket.id, username: socket.data?.username }]</span></span>
<span class="line"><span style="color:#C9D1D9">    });</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// returns Map(1){'2b5b51a9-707b-42d6-9da8-dc19f863c0d0' =&gt; [{id: 'socketid', username: 'username1'}]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#D2A8FF">callback</span><span style="color:#C9D1D9">(roomId); </span><span style="color:#8B949E">// &lt;- 4 respond with roomId to client by calling the callback function from the client</span></span>
<span class="line"><span style="color:#C9D1D9">  });</span></span>
<span class="line"><span style="color:#C9D1D9">});</span></span></code></pre>
<p>Each numbered line below maps to a line-number comment in the code above. In the <code>createRoom</code> event listener:</p>
<ol>
<li>A new room ID is created using the <code>uuid</code> package.</li>
<li>The player creating the room joins the room.</li>
<li>A key-value pair is added to the rooms map, with the uuid as key and room data as value. The room data contains the room Id and list of players.</li>
<li>The <code>callback</code> function passed as data from the client (as shown previously in the <code>onclick</code> function of the “continue” button of the <code>CustomDialog</code>) is received in the listener function on the server. This callback is called at the end with the newly created <code>roomId</code> passed as a parameter. When the <code>callback</code> is called, the client receives the roomId as a response from the server.</li>
</ol>
<p>To implement room joins, the client application has to emit a socket.io event named <code>joinRoom</code> that will be handled by the server. This event’s data will include the ID of the room the player intends to join.</p>
<p>As outlined earlier, on the client-side, the socket.io client needs to emit a <code>joinRoom</code> event to the server when a user tries to join a room. Update the <code>handleContinue</code> prop of the <code>CustomDialog</code> element in the <code>InitGame</code> component, as shown below:</p>
<p><code>client/src/InitGame.js</code></p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9">&lt;</span><span style="color:#7EE787">CustomDialog</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#79C0FF">handleContinue</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// join a room</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (</span><span style="color:#FF7B72">!</span><span style="color:#C9D1D9">roomInput) </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9">; </span><span style="color:#8B949E">// if given room input is valid, do nothing.</span></span>
<span class="line"><span style="color:#C9D1D9">    socket.</span><span style="color:#D2A8FF">emit</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"joinRoom"</span><span style="color:#C9D1D9">, { roomId: roomInput }, (</span><span style="color:#FFA657">r</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#8B949E">// r is the response from the server</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (r.error) </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">setRoomError</span><span style="color:#C9D1D9">(r.message); </span><span style="color:#8B949E">// if an error is returned in the response set roomError to the error message and exit</span></span>
<span class="line"><span style="color:#C9D1D9">      console.</span><span style="color:#D2A8FF">log</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"response:"</span><span style="color:#C9D1D9">, r);</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#D2A8FF">setRoom</span><span style="color:#C9D1D9">(r?.roomId); </span><span style="color:#8B949E">// set room to the room ID</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#D2A8FF">setPlayers</span><span style="color:#C9D1D9">(r?.players); </span><span style="color:#8B949E">// set players array to the array of players in the room</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#D2A8FF">setOrientation</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"black"</span><span style="color:#C9D1D9">); </span><span style="color:#8B949E">// set orientation as black</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#D2A8FF">setRoomDialogOpen</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">false</span><span style="color:#C9D1D9">); </span><span style="color:#8B949E">// close dialog</span></span>
<span class="line"><span style="color:#C9D1D9">    });</span></span>
<span class="line"><span style="color:#C9D1D9">  }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/** ... */</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">&lt;/</span><span style="color:#7EE787">CustomDialog</span><span style="color:#C9D1D9">&gt;</span></span></code></pre>
<p>From the code snippet above:</p>
<ul>
<li>a socket.io event called <code>joinRoom</code> is emitted along with the room ID when a user clicks on the ‘continue’ button in the dialog.</li>
<li>a callback function is also used to receive a response from the server.</li>
<li>we set the <code>room</code> and <code>players</code> states to the respective data returned from the callback, and we also set the orientation to “black”.</li>
</ul>
<p>On the server side, we need to add a listener to listen to a <code>joinRoom</code> event and perform actions necessary to join a room. In the listener, we need to check that a room exists, has a player waiting, and is not full. If any of these conditions are not met, we return an error to the user indicating that the room ID is invalid.</p>
<p>The complete code for this implementation is available in the <code>InitGame.js</code> file located <a href="https://github.com/judgegodwins/multiplayer-chess/blob/before-disconnect/client/src/InitGame.js">here</a>.</p>
<p>In the <code>server/server.js</code> file, add a new <code>joinRoom</code> event listener in the <code>io.on('connection')</code> callback:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">io.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'connection'</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">socket</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9">  socket.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'joinRoom'</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">async</span><span style="color:#C9D1D9"> (</span><span style="color:#FFA657">args</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">callback</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// check if room exists and has a player waiting</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">room</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> rooms.</span><span style="color:#D2A8FF">get</span><span style="color:#C9D1D9">(args.roomId);</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">let</span><span style="color:#C9D1D9"> error, message;</span></span>
<span class="line"><span style="color:#C9D1D9">  </span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (</span><span style="color:#FF7B72">!</span><span style="color:#C9D1D9">room) { </span><span style="color:#8B949E">// if room does not exist</span></span>
<span class="line"><span style="color:#C9D1D9">      error </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">true</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">      message </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">'room does not exist'</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">    } </span><span style="color:#FF7B72">else</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (room.</span><span style="color:#79C0FF">length</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">&lt;=</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">0</span><span style="color:#C9D1D9">) { </span><span style="color:#8B949E">// if room is empty set appropriate message</span></span>
<span class="line"><span style="color:#C9D1D9">      error </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">true</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">      message </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">'room is empty'</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">    } </span><span style="color:#FF7B72">else</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (room.</span><span style="color:#79C0FF">length</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">&gt;=</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">2</span><span style="color:#C9D1D9">) { </span><span style="color:#8B949E">// if room is full</span></span>
<span class="line"><span style="color:#C9D1D9">      error </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">true</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">      message </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">'room is full'</span><span style="color:#C9D1D9">; </span><span style="color:#8B949E">// set message to 'room is full'</span></span>
<span class="line"><span style="color:#C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (error) {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#8B949E">// if there's an error, check if the client passed a callback,</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#8B949E">// call the callback (if it exists) with an error object and exit or </span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#8B949E">// just exit if the callback is not given</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (callback) { </span><span style="color:#8B949E">// if user passed a callback, call it with an error payload</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#D2A8FF">callback</span><span style="color:#C9D1D9">({</span></span>
<span class="line"><span style="color:#C9D1D9">          error,</span></span>
<span class="line"><span style="color:#C9D1D9">          message</span></span>
<span class="line"><span style="color:#C9D1D9">        });</span></span>
<span class="line"><span style="color:#C9D1D9">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9">; </span><span style="color:#8B949E">// exit</span></span>
<span class="line"><span style="color:#C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">await</span><span style="color:#C9D1D9"> socket.</span><span style="color:#D2A8FF">join</span><span style="color:#C9D1D9">(args.roomId); </span><span style="color:#8B949E">// make the joining client join the room</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// add the joining user's data to the list of players in the room</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">roomUpdate</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">...</span><span style="color:#C9D1D9">room,</span></span>
<span class="line"><span style="color:#C9D1D9">      players: [</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#FF7B72">...</span><span style="color:#C9D1D9">room.players,</span></span>
<span class="line"><span style="color:#C9D1D9">        { id: socket.id, username: socket.data?.username },</span></span>
<span class="line"><span style="color:#C9D1D9">      ],</span></span>
<span class="line"><span style="color:#C9D1D9">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    rooms.</span><span style="color:#D2A8FF">set</span><span style="color:#C9D1D9">(args.roomId, roomUpdate);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#D2A8FF">callback</span><span style="color:#C9D1D9">(roomUpdate); </span><span style="color:#8B949E">// respond to the client with the room details.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// emit an 'opponentJoined' event to the room to tell the other player that an opponent has joined</span></span>
<span class="line"><span style="color:#C9D1D9">    socket.</span><span style="color:#D2A8FF">to</span><span style="color:#C9D1D9">(args.roomId).</span><span style="color:#D2A8FF">emit</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'opponentJoined'</span><span style="color:#C9D1D9">, roomUpdate);</span></span>
<span class="line"><span style="color:#C9D1D9">  });</span></span>
<span class="line"><span style="color:#C9D1D9">});</span></span></code></pre>
<p>Be sure to read the comments in the code to gain a clearer understanding of what’s going on.</p>
<p>The code snippet above includes a validation step to confirm the room ID’s validity. If the ID is valid, the “joining player” is added to the room, and a response containing the room ID and the list of players in the room is sent back to the “joining player” using the callback function. Additionally, we notify the other player in the room that an opponent has joined, indicating that the game is ready to begin. If the room ID is invalid, we respond with an error message. This error message is handled in the callback function passed to the <code>socket.emit</code> call in the <code>handleContinue</code> prop of the room-joining dialog in the <code>InitGame</code> component, as shown earlier.</p>
<p>Now, we need to update the <code>App</code> component in <code>App.js</code> to render the <code>Game</code> component only when a room has been created or joined by the user, otherwise, the <code>InitGame</code> component is rendered so that the user can choose to create or join a game room.</p>
<p>Modify the App component to resemble the following code:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { useEffect, useState, useCallback } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"react"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> Container </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"@mui/material/Container"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> Game </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"./Game"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> InitGame </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"./InitGame"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> CustomDialog </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"./components/CustomDialog"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> socket </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"./socket"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { TextField } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"@mui/material"</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">export</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">default</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">function</span><span style="color:#FFA657"> </span><span style="color:#D2A8FF">App</span><span style="color:#FFA657">() </span><span style="color:#C9D1D9">{</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">username</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setUsername</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">""</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">usernameSubmitted</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setUsernameSubmitted</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">false</span><span style="color:#C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">room</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setRoom</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">""</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">orientation</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setOrientation</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">""</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">players</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setPlayers</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">([]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// resets the states responsible for initializing a game</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">cleanup</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useCallback</span><span style="color:#C9D1D9">(() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#D2A8FF">setRoom</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">""</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#D2A8FF">setOrientation</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">""</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#D2A8FF">setPlayers</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">""</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">  }, []);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#D2A8FF">useEffect</span><span style="color:#C9D1D9">(() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// const username = prompt("Username");</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// setUsername(username);</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// socket.emit("username", username);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    socket.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"opponentJoined"</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">roomData</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      console.</span><span style="color:#D2A8FF">log</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"roomData"</span><span style="color:#C9D1D9">, roomData)</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#D2A8FF">setPlayers</span><span style="color:#C9D1D9">(roomData.players);</span></span>
<span class="line"><span style="color:#C9D1D9">    });</span></span>
<span class="line"><span style="color:#C9D1D9">  }, []);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">Container</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">CustomDialog</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">open</span><span style="color:#FF7B72">={!</span><span style="color:#C9D1D9">usernameSubmitted</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">handleClose</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">setUsernameSubmitted</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">true</span><span style="color:#C9D1D9">)</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">title</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"Pick a username"</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">contentText</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"Please select a username"</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">handleContinue</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (</span><span style="color:#FF7B72">!</span><span style="color:#C9D1D9">username) </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">          socket.</span><span style="color:#D2A8FF">emit</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"username"</span><span style="color:#C9D1D9">, username);</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#D2A8FF">setUsernameSubmitted</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">true</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">        }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">TextField</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">autoFocus</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">margin</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"dense"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">id</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"username"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">label</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"Username"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">name</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"username"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">value</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">username</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">required</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">onChange</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">(</span><span style="color:#FFA657">e</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">setUsername</span><span style="color:#C9D1D9">(e.target.value)</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">type</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"text"</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">fullWidth</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">variant</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"standard"</span></span>
<span class="line"><span style="color:#C9D1D9">        /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">CustomDialog</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">room </span><span style="color:#FF7B72">?</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">Game</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">room</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">room</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">orientation</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">orientation</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">username</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">username</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">players</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">players</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#8B949E">// the cleanup function will be used by Game to reset the state when a game is over</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">cleanup</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">cleanup</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      ) </span><span style="color:#FF7B72">:</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">InitGame</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">setRoom</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">setRoom</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">setOrientation</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">setOrientation</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">setPlayers</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">setPlayers</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      )</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">Container</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span></code></pre>
<p>Notice the following:</p>
<ul>
<li>We added three new states (<code>room</code>, <code>players</code> and <code>orientation</code>)
<ul>
<li><code>room</code>: stores the current room ID</li>
<li><code>players</code>: stores the players in a room</li>
<li><code>orientation</code>: stores the board orientation for a user.</li>
</ul>
</li>
<li>These 3 new states are updated in the <code>InitGame</code> component as shown earlier when a user joins or creates a game room.</li>
<li>The <code>cleanup</code> function resets the three states mentioned above which are responsible for initializing a game. This function will be used in the <code>Game</code> component when the game is over.</li>
<li>The <code>Game</code> component is now conditionally rendered only when a room has been created or joined (i.e when the <code>room</code> state holds a truthy value).</li>
<li>The <code>InitGame</code> component is rendered if a room has not yet been created or joined, allowing a user to create or join a game room. It receives three functions (<code>setRoom</code>, <code>setOrientation</code>, and <code>setPlayers</code>) as props, which are used to update the <code>room</code>, <code>orientation</code>, and <code>players</code> states, respectively, when a user creates or joins a game.</li>
<li>Since WebSocket connections allow 2-way communication between the server and client, we added a socket.io event listener in the <code>useEffect</code> hook that listens to the <code>opponentJoined</code> event. As discussed earlier, the server emits the <code>opponentJoined</code> event to a player when an opponent has joined a room they created. This event comes with the room data (including the list of players in the room), so we simply set the <code>players</code> state to the value of <code>roomData.players</code> received from the event data.</li>
</ul>
<p>To launch the app on your browser, ensure that the backend server is running on <code>localhost:8080</code>. Enter a username and click on the “Start Game” button to trigger the <code>createRoom</code> event, which will generate a room ID. You will find the room ID logged in the browser console. To join the same room from a different browser tab, open a new tab, enter a different username, and click on “Join a Game”. Next, copy and paste the room ID from the console in the previous tab and click on “Continue”. Upon joining the room, you will see the list of players logged on the console of the first tab. This list is retrieved from the “opponentJoined” event that is received by the room creator when an opponent joins the game room.</p>
<p><img src="./Building a Chess Game with React_files/uHIgqpP.gif" alt="-"></p>
<h2 id="handling-piece-movements">Handling Piece Movements</h2>
<p>Whenever a player (let’s say player-1) makes a move, our application should send a <code>move</code> event to the player on the other end (player-2) to reflect the moves made by player-1. The <code>Game</code> component will handle the logic for transmitting <code>move</code> events.</p>
<p>Whenever a piece is moved, the <code>onDrop</code> function in the <code>Game</code> component is triggered. This function currently takes in two arguments (<code>sourceSquare</code> and <code>targetSquare</code>). It creates a <code>move</code> object using these arguments and then calls the <code>makeAMove</code> function (with the <code>move</code> object as a parameter), which passes the <code>move</code> object to the Chess.js instance for validation and state update. To inform the other player of a move, we will need to emit a socket event named <code>move</code>. This event will contain the move data. Once the other player receives this event, the <code>makeAMove</code> function will be called on their end to update the app’s state.</p>
<p>Before we update the <code>onDrop</code> function, let’s import the socket.io client into <code>Game.js</code>. Add the following import statement at the top of the <code>Game.js</code> file:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> socket </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"./socket"</span><span style="color:#C9D1D9">;</span></span></code></pre>
<p>Let’s update the <code>onDrop</code> function in the <code>Game</code> component</p>
<p><code>Game.js</code></p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// onDrop function</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">function</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">onDrop</span><span style="color:#C9D1D9">(</span><span style="color:#FFA657">sourceSquare</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">targetSquare</span><span style="color:#C9D1D9">) {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// orientation is either 'white' or 'black'. game.turn() returns 'w' or 'b'</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (chess.</span><span style="color:#D2A8FF">turn</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">!==</span><span style="color:#C9D1D9"> orientation[</span><span style="color:#79C0FF">0</span><span style="color:#C9D1D9">]) </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">false</span><span style="color:#C9D1D9">; </span><span style="color:#8B949E">// &lt;- 1 prohibit player from moving piece of other player</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (players.</span><span style="color:#79C0FF">length</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">&lt;</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">2</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">false</span><span style="color:#C9D1D9">; </span><span style="color:#8B949E">// &lt;- 2 disallow a move if the opponent has not joined</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">moveData</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      from: sourceSquare,</span></span>
<span class="line"><span style="color:#C9D1D9">      to: targetSquare,</span></span>
<span class="line"><span style="color:#C9D1D9">      color: chess.</span><span style="color:#D2A8FF">turn</span><span style="color:#C9D1D9">(),</span></span>
<span class="line"><span style="color:#C9D1D9">      promotion: </span><span style="color:#A5D6FF">"q"</span><span style="color:#C9D1D9">, </span><span style="color:#8B949E">// promote to queen where possible</span></span>
<span class="line"><span style="color:#C9D1D9">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">move</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">makeAMove</span><span style="color:#C9D1D9">(moveData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// illegal move</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (move </span><span style="color:#FF7B72">===</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">null</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">false</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    socket.</span><span style="color:#D2A8FF">emit</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"move"</span><span style="color:#C9D1D9">, { </span><span style="color:#8B949E">// &lt;- 3 emit a move event.</span></span>
<span class="line"><span style="color:#C9D1D9">      move,</span></span>
<span class="line"><span style="color:#C9D1D9">      room,</span></span>
<span class="line"><span style="color:#C9D1D9">    }); </span><span style="color:#8B949E">// this event will be transmitted to the opponent via the server</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">true</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">  }</span></span></code></pre>
<p>Each numbered line below maps to a line-number comment in the code above:</p>
<ol>
<li>A check is made to ensure that a player cannot move the chess pieces of their opponents. For example, a player on the white side should not be able to move black pieces.</li>
<li>A check is made to ensure that an opponent is connected before making a move.</li>
<li>After a move is validated and played, an event called <code>move</code> is emitted to the game room along with the move data. This move data would be emitted to the opponent’s client app.</li>
</ol>
<p>How does the opponent receive the move data emitted by the first player? To accomplish this, we must utilize socket.io event listeners in both the backend and the client.</p>
<p>Let’s set up the backend server to listen to <code>move</code> event and transmit it to the second player.</p>
<p>In the <code>server.js</code> file, add a new <code>move</code> event listener function in the <code>io.on("connection")</code> callback function:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9">io.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'connection'</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">socket</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9">  socket.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'move'</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">data</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// emit to all sockets in the room except the emitting socket.</span></span>
<span class="line"><span style="color:#C9D1D9">    socket.</span><span style="color:#D2A8FF">to</span><span style="color:#C9D1D9">(data.room).</span><span style="color:#D2A8FF">emit</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'move'</span><span style="color:#C9D1D9">, data.move);</span></span>
<span class="line"><span style="color:#C9D1D9">  });</span></span>
<span class="line"><span style="color:#C9D1D9">});</span></span></code></pre>
<p>In the code above, when a <code>move</code> event is received on the backend, it is broadcasted to all sockets in the room except the socket that generated the event. So if player-1 and player-2 are in the same game room and player-1 emits a <code>move</code> event, every socket except player-1’s socket connection will receive the <code>move</code> event, in this case, only player-2’s client receives the <code>move</code> event.</p>
<p>Here’s a visual representation of the event flow:</p>
<p><img src="./Building a Chess Game with React_files/1sQnXvi.png" alt="-"></p>
<p>When the backend server emits the <code>move</code> event to player-2’s client,  player-2’s client needs to listen to this event and play the move on behalf of player-1. Therefore, we need to set up an event listener on the <code>Game</code> component. The listener function will be triggered whenever the opponent makes a move. We’ll set up the listener in a useEffect hook so it’ll be registered when the component is mounted.</p>
<p>Add the following <code>useEffect</code> hook to the <code>Game</code> component in <code>Game.js</code> below the <code>onDrop</code> function:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">  </span><span style="color:#D2A8FF">useEffect</span><span style="color:#C9D1D9">(() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    socket.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"move"</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">move</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#D2A8FF">makeAMove</span><span style="color:#C9D1D9">(move); </span><span style="color:#8B949E">//</span></span>
<span class="line"><span style="color:#C9D1D9">    });</span></span>
<span class="line"><span style="color:#C9D1D9">  }, [makeAMove]);</span></span></code></pre>
<p>In the code above, we set up the socket.io event listener when the component is mounted (i.e, in the <code>useEffect</code> hook). When a client receive’s a <code>move</code> event, the move is validated and played using the <code>makeAMove</code> function.</p>
<p>In the Game’s UI, we need to display the game room’s ID and list of players.</p>
<p>Add the following at the top of <code>Game.js</code> to import UI components from Material UI:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  Card,</span></span>
<span class="line"><span style="color:#C9D1D9">  CardContent,</span></span>
<span class="line"><span style="color:#C9D1D9">  List,</span></span>
<span class="line"><span style="color:#C9D1D9">  ListItem,</span></span>
<span class="line"><span style="color:#C9D1D9">  ListItemText,</span></span>
<span class="line"><span style="color:#C9D1D9">  ListSubheader,</span></span>
<span class="line"><span style="color:#C9D1D9">  Stack,</span></span>
<span class="line"><span style="color:#C9D1D9">  Typography,</span></span>
<span class="line"><span style="color:#C9D1D9">  Box,</span></span>
<span class="line"><span style="color:#C9D1D9">} </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">"@mui/material"</span><span style="color:#C9D1D9">;</span></span></code></pre>
<p>Update the returned JSX in the <code>Game</code> component to display the room ID and players:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#8B949E">// Game component returned jsx</span></span>
<span class="line"><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;</span><span style="color:#7EE787">Stack</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">Card</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">CardContent</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">Typography</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">variant</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"h5"</span><span style="color:#C9D1D9">&gt;Room ID: </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">room</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&lt;/</span><span style="color:#7EE787">Typography</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">CardContent</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">Card</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">Stack</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">flexDirection</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"row"</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">sx</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">{ pt: </span><span style="color:#79C0FF">2</span><span style="color:#C9D1D9"> }</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">"board"</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">style</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">{</span></span>
<span class="line"><span style="color:#C9D1D9">        maxWidth: </span><span style="color:#79C0FF">600</span><span style="color:#C9D1D9">,</span></span>
<span class="line"><span style="color:#C9D1D9">        maxHeight: </span><span style="color:#79C0FF">600</span><span style="color:#C9D1D9">,</span></span>
<span class="line"><span style="color:#C9D1D9">        flexGrow: </span><span style="color:#79C0FF">1</span><span style="color:#C9D1D9">,</span></span>
<span class="line"><span style="color:#C9D1D9">      }</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">Chessboard</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">position</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">fen</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">onPieceDrop</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">onDrop</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#79C0FF">boardOrientation</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">orientation</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">players.</span><span style="color:#79C0FF">length</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">&gt;</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">0</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">&amp;&amp;</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">Box</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">          &lt;</span><span style="color:#7EE787">List</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">            &lt;</span><span style="color:#7EE787">ListSubheader</span><span style="color:#C9D1D9">&gt;Players&lt;/</span><span style="color:#7EE787">ListSubheader</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">            </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">players.</span><span style="color:#D2A8FF">map</span><span style="color:#C9D1D9">((</span><span style="color:#FFA657">p</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">              &lt;</span><span style="color:#7EE787">ListItem</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">key</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">p.id</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">                &lt;</span><span style="color:#7EE787">ListItemText</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">primary</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">p.username</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9"> /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">              &lt;/</span><span style="color:#7EE787">ListItem</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">            ))</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          &lt;/</span><span style="color:#7EE787">List</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;/</span><span style="color:#7EE787">Box</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      )</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">Stack</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">CustomDialog</span><span style="color:#C9D1D9"> </span><span style="color:#8B949E">// Game Over CustomDialog</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">open</span><span style="color:#FF7B72">={</span><span style="color:#D2A8FF">Boolean</span><span style="color:#C9D1D9">(over)</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">title</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">over</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">contentText</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">over</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">handleContinue</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#D2A8FF">setOver</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">""</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">      }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;/</span><span style="color:#7EE787">Stack</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">);</span></span></code></pre>
<p>Here’s a breakdown of what’s happening:</p>
<ul>
<li>
<p>The code is returning a React component that renders a stack of elements using the <code>&lt;Stack&gt;</code> component provided by Material UI.</p>
</li>
<li>
<p>The first element in the stack is a <code>&lt;Card&gt;</code> component with a <code>&lt;Typography&gt;</code> component inside of it that displays the room ID. <code>Typography</code> is a Material UI component used for rendering text.</p>
</li>
<li>
<p>The second element in the stack is a horizontal stack (<code>flexDirection="row</code>) created with another <code>&lt;Stack&gt;</code> component. It contains a <code>&lt;div&gt;</code> element with a <code>className</code> of <code>board</code> that sets some CSS styles to specify the size of the board.</p>
</li>
<li>
<p>Notice the new prop in the <code>Chessboard</code> component called <code>boardOrientation</code>. This determines the orientation of the chessboard for a player, which could be either white or black. Players who create a room play on the white side by default, while players who join a room play on the black side.</p>
</li>
<li>
<p>The second element in the horizontal stack also conditionally renders a <code>&lt;Box&gt;</code> component that contains a <code>&lt;List&gt;</code> of player names. This only occurs if the players array has at least one item.</p>
</li>
<li>
<p>The third element in the stack is a custom dialog box (<code>&lt;CustomDialog&gt;</code>) that displays when the <code>over</code> state variable is truthy. It contains a title, some content text, and a button that clears the over state when clicked.</p>
</li>
</ul>
<p>Overall, the code above renders a chess game interface with a board and player list, and a custom dialog for when the game is over.</p>
<p>You can view the entire content of <code>Game.js</code> at this point <a href="https://github.com/judgegodwins/multiplayer-chess/blob/before-disconnect/client/src/Game.js">here</a></p>
<p>Two players can now play against each other provided they are in the same room. Launch the app (make sure the server is up and running the coommand <code>npm start</code> on the server directory), open two browser tabs, create and join a room on each tab. Try playing both sides to get a checkmate.</p>
<p><img src="./Building a Chess Game with React_files/4W50YCr.gif" alt="-"></p>
<h2 id="handling-disconnections">Handling Disconnections</h2>
<p>When a player gets disconnected while in a game room, the other player in the room has to be informed that the opponent has been disconnected. In a production app, you’ll want to implement some reconnection logic to allow disconnected clients to automatically rejoin a game room after they have reconnected. More information on this can be found in the “Conclusion” section of this article. For simplicity, when a client disconnects, we’ll just inform the other player that the opponent has been disconnected and then close the game room.</p>
<p>How does the server know when a client has been disconnected? Socket.io emits a special event called <code>disconnect</code> from the client to the server whenever a client gets disconnected. We can set up a <code>disconnect</code> event listener in the server and emit a <code>playerDisconnected</code> event to all rooms that the client has joined. When this event is emitted to a room, the other player in the room will receive this event and will be notified of the opponent’s disconnection.</p>
<p>Let’s add the <code>disconnect</code> event listener. In the <code>server.js</code> file, add a new <code>disconnect</code> event listener in the <code>io.on("connection")</code> callback function just below the <code>move</code> event listener.</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#8B949E">// io.connection</span></span>
<span class="line"><span style="color:#C9D1D9">io.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"connection"</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">socket</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9">  </span></span>
<span class="line"><span style="color:#C9D1D9">  socket.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"disconnect"</span><span style="color:#C9D1D9">, () </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">gameRooms</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> Array.</span><span style="color:#D2A8FF">from</span><span style="color:#C9D1D9">(rooms.</span><span style="color:#D2A8FF">values</span><span style="color:#C9D1D9">()); </span><span style="color:#8B949E">// &lt;- 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    gameRooms.</span><span style="color:#D2A8FF">forEach</span><span style="color:#C9D1D9">((</span><span style="color:#FFA657">room</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> { </span><span style="color:#8B949E">// &lt;- 2</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">userInRoom</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> room.players.</span><span style="color:#D2A8FF">find</span><span style="color:#C9D1D9">((</span><span style="color:#FFA657">player</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> player.id </span><span style="color:#FF7B72">===</span><span style="color:#C9D1D9"> socket.id); </span><span style="color:#8B949E">// &lt;- 3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (userInRoom) {</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (room.players.</span><span style="color:#79C0FF">length</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">&lt;</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">2</span><span style="color:#C9D1D9">) {</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#8B949E">// if there's only 1 player in the room, close it and exit.</span></span>
<span class="line"><span style="color:#C9D1D9">          rooms.</span><span style="color:#D2A8FF">delete</span><span style="color:#C9D1D9">(room.roomId);</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#C9D1D9">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">        socket.</span><span style="color:#D2A8FF">to</span><span style="color:#C9D1D9">(room.roomId).</span><span style="color:#D2A8FF">emit</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"playerDisconnected"</span><span style="color:#C9D1D9">, userInRoom); </span><span style="color:#8B949E">// &lt;- 4</span></span>
<span class="line"><span style="color:#C9D1D9">      }</span></span>
<span class="line"><span style="color:#C9D1D9">    });</span></span>
<span class="line"><span style="color:#C9D1D9">  });</span></span>
<span class="line"><span style="color:#C9D1D9">});</span></span></code></pre>
<p>In the code above, we added a <code>disconnect</code> event listener. Below is a breakdown of what’s happening in the listener’s callback function. Notice the line number comments in the code above; each numbered line below corresponds to a line-number comment in the code above.</p>
<ol>
<li>The list of available rooms can be retrieved and stored in the <code>gameRooms</code> variable. To obtain an array of all values within a map, we made use the <code>.values()</code> method. Specifically, calling <code>rooms.values()</code> would return an array containing all the values from the key-value pairs within the rooms map.</li>
<li>We loop over every room in the rooms map in a bid to find out what rooms the disconnecting client joined.</li>
<li>Using the socket ID as a reference, we iterate over the list of players in the current room being looped over to find out if the disconnecting client/player is part of it.</li>
<li>If the disconnecting client is part of the room, we simply emit a <code>playerDisconnected</code> event to the room, this event will be received by the other players in the room.</li>
</ol>
<p>In order to notify the user when an opponent has been disconnected, the client-side application must listen for the <code>playerDisconnected</code> event.</p>
<p>Add a new <code>useEffect</code> hook in the <code>Game</code> component in <code>Game.js</code>, the listener will be registered in this hook as seen below:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">function</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Game</span><span style="color:#C9D1D9">({ </span><span style="color:#FFA657">players</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">username</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">room</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">orientation</span><span style="color:#C9D1D9"> }) {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9">  </span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#D2A8FF">useEffect</span><span style="color:#C9D1D9">(() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    socket.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'playerDisconnected'</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">player</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#D2A8FF">setOver</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">`${</span><span style="color:#C9D1D9">player</span><span style="color:#A5D6FF">.</span><span style="color:#C9D1D9">username</span><span style="color:#A5D6FF">} has disconnected`</span><span style="color:#C9D1D9">); </span><span style="color:#8B949E">// set game over</span></span>
<span class="line"><span style="color:#C9D1D9">    });</span></span>
<span class="line"><span style="color:#C9D1D9">  }, []);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span></code></pre>
<p>When the <code>playerDiconnected</code> event is received, we simply set the over state to “(username) has disconnected”. This state change causes the “game over” alert dialog to pop up as shown below.</p>
<p><img src="./Building a Chess Game with React_files/5uHecDr.gif" alt="-"></p>
<h2 id="freeing-up-resources">Freeing Up Resources</h2>
<p>After a game is finished, it is necessary for both the client and server to release the resources that were used to initialize the game. This involves closing the game room and removing it from the rooms map on the backend, as well as having all client sockets exit the room.</p>
<p>To implement this, a new event called <code>closeRoom</code> needs to be created. This event will be triggered when a player clicks on the “Continue” button in the “game over” alert dialog. To set up this event, the <code>handleContinue</code> function prop of the “game over” <code>CustomDialog</code> element in <code>Game.js</code> should be updated to emit a “closeRoom” event on the websocket connection:</p>
<p><code>Game.js</code></p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#FF7B72">function</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Game</span><span style="color:#C9D1D9">({ </span><span style="color:#FFA657">players</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">room</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">orientation</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">cleanup</span><span style="color:#C9D1D9"> }) {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9"> </span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">CustomDialog</span><span style="color:#C9D1D9"> </span><span style="color:#8B949E">// Game Over CustomDialog</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">open</span><span style="color:#FF7B72">={</span><span style="color:#D2A8FF">Boolean</span><span style="color:#C9D1D9">(over)</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">title</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">over</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">contentText</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">over</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">handleContinue</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">          socket.</span><span style="color:#D2A8FF">emit</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"closeRoom"</span><span style="color:#C9D1D9">, { roomId: room });</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#D2A8FF">cleanup</span><span style="color:#C9D1D9">();</span></span>
<span class="line"><span style="color:#C9D1D9">        }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      /&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span></code></pre>
<p>In the code snippet above, we only modified the <code>handleContinue</code> function prop of the <code>CustomDialog</code> component that appears when a game is finished. In the <code>handleContinue</code> function, a <code>closeRoom</code> event is transmitted to the server, along with the room ID as data. The backend will manage the room closure, as you will soon discover. Following that, we invoke the <code>cleanup</code> function, which resets the state of the application, as previously described.</p>
<p>The server has to listen to the <code>closeRoom</code> event and perform the operations to close a room and free up resources. Let’s add a new <code>closeRoom</code> event listener in the <code>io.on("connection")</code> callback function in the <code>server.js</code> file:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#C9D1D9">io.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"connection"</span><span style="color:#C9D1D9">, (</span><span style="color:#FFA657">socket</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  socket.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"closeRoom"</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">async</span><span style="color:#C9D1D9"> (</span><span style="color:#FFA657">data</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    socket.</span><span style="color:#D2A8FF">to</span><span style="color:#C9D1D9">(data.roomId).</span><span style="color:#D2A8FF">emit</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">"closeRoom"</span><span style="color:#C9D1D9">, data); </span><span style="color:#8B949E">// &lt;- 1 inform others in the room that the room is closing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">clientSockets</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">await</span><span style="color:#C9D1D9"> io.</span><span style="color:#D2A8FF">in</span><span style="color:#C9D1D9">(data.roomId).</span><span style="color:#D2A8FF">fetchSockets</span><span style="color:#C9D1D9">(); </span><span style="color:#8B949E">// &lt;- 2 get all sockets in a room</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#8B949E">// loop over each socket client</span></span>
<span class="line"><span style="color:#C9D1D9">    clientSockets.</span><span style="color:#D2A8FF">forEach</span><span style="color:#C9D1D9">((</span><span style="color:#FFA657">s</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      s.</span><span style="color:#D2A8FF">leave</span><span style="color:#C9D1D9">(data.roomId); </span><span style="color:#8B949E">// &lt;- 3 and make them leave the room on socket.io</span></span>
<span class="line"><span style="color:#C9D1D9">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    rooms.</span><span style="color:#D2A8FF">delete</span><span style="color:#C9D1D9">(data.roomId); </span><span style="color:#8B949E">// &lt;- 4 delete room from rooms map</span></span>
<span class="line"><span style="color:#C9D1D9">  });</span></span>
<span class="line"><span style="color:#C9D1D9">});</span></span></code></pre>
<p>Notice the line number comments in the code above; each numbered line below corresponds to a line-number comment in the code above.</p>
<ol>
<li>The <code>closeRoom</code> event is broadcasted to the other clients in the room to let them know that the room is closing.</li>
<li>All clients that have joined a room (using the socket.join method) are retrieved. The value of the variable <code>fetchedSockets</code> is an array of all clients in the room.</li>
<li>The array of client sockets is iterated over, and each socket is made to leave the room using the <code>socket.leave</code> method.</li>
<li>Finally, the room is removed from the map of rooms.</li>
</ol>
<p>As explained earlier, when a <code>closeRoom</code> event is received by the server, the server broadcasts the event to all clients in the room except the client that generated the event. The client applications need to listen to the <code>closeRoom</code> event in order to free up resources and leave the game environment. We can set up this listener in a new <code>useEffect</code> hook in the <code>Game</code> component. Add a new <code>useEffect</code> hook to the <code>Game</code> component in <code>Game.js</code> as shown below:</p>
<pre class="astro-code" style="background-color:#0d1117;overflow-x:auto"><code><span class="line"><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#FF7B72">function</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Game</span><span style="color:#C9D1D9">({ </span><span style="color:#FFA657">players</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">room</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">orientation</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">cleanup</span><span style="color:#C9D1D9"> }) {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#D2A8FF">useEffect</span><span style="color:#C9D1D9">(() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    socket.</span><span style="color:#D2A8FF">on</span><span style="color:#C9D1D9">(</span><span style="color:#A5D6FF">'closeRoom'</span><span style="color:#C9D1D9">, ({ </span><span style="color:#FFA657">roomId</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (roomId </span><span style="color:#FF7B72">===</span><span style="color:#C9D1D9"> room) {</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#D2A8FF">cleanup</span><span style="color:#C9D1D9">();</span></span>
<span class="line"><span style="color:#C9D1D9">      }</span></span>
<span class="line"><span style="color:#C9D1D9">    });</span></span>
<span class="line"><span style="color:#C9D1D9">  }, [room, cleanup]);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#8B949E">// ...</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span></code></pre>
<p>In the code snippet above, when the client application receives a <code>closeRoom</code> event, it first checks if the ID of the closed room is the same as the currently joined room. It then calls <code>cleanup</code>, which resets the application’s state and exits the game environment. By resetting the <code>room</code> state, the <code>Game</code> component is unmounted and the <code>InitGame</code> component is mounted in its place.</p>
<p>To execute the code, run the application and create two browser tabs. Then, on one tab, create a game room, and on the other, join the room. Try to obtain a checkmate, which will trigger the “game over” alert dialog to appear. Once you click “Continue”, the “closeRoom” event will be transmitted via the websocket connection, and the cleanup function will be executed after sending the event. As a result, the Game component will be unmounted. The other client in the second tab will receive the “closeRoom” event, causing it to leave the game environment. This is demonstrated in the following example:</p>
<p><img src="./Building a Chess Game with React_files/98PiZHl.gif" alt="-"></p>
<h2 id="conclusion">Conclusion</h2>
<p>In this article, we’ve learned how to build a multiplayer chess game using <code>react-chessboard</code> to render the chessboard, <code>chess.js</code> for chess logic including moves and validation, and <code>socket.io</code> for websocket connectivity.</p>
<p>If you’re considering building a multiplayer chess game for production, here are some suggestions to make the app production-ready:</p>
<ol>
<li>Implement an authentication system to attach persistent user IDs to client sockets. This way, a client’s websocket connection can be easily identified. Here’s an example that illustrates the concept.</li>
<li>Persist room data and game state. On the backend, store the game state and room data on a persistent and fast database like Redis. This way, if the server is restarted, room data and game states won’t be lost. When a disconnected client app reconnects, the room data and game state can be retrieved from the backend, and the client app can continue the game.</li>
</ol>
<div class="p-5 bg-gradient-to-t from-violet-100 from-90% to-blue-50 to-180% rounded-md">
<h3>Gain Debugging Superpowers</h3> 
<p class="text-slate-800">
  Unleash the power of session replay to reproduce bugs and track user frustrations. Get complete visibility into your frontend with OpenReplay, the most advanced open-source session replay tool for developers.
</p>
<a class="post-end-cta-img-web hover:opacity-90" href="https://github.com/openreplay/openreplay" target="_blank"><img class="my-4" src="./Building a Chess Game with React_files/openreplay-git-hero.svg" alt="OpenReplay"></a>
  <div class="grid gap-4 md:grid-cols-2 text-center mt-4">
    <a class="post-end-cta-git flex px-3 py-2 font-normal rounded-md no-underline bg-brand-blue hover:bg-indigo-700 text-white justify-center" href="https://github.com/openreplay/openreplay" target="_blank">
      <p class="flex items-center gap-1"><span class="inline-block align-text-top"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
      </svg></span> Check our GitHub Repo</p>
    </a>
  </div>
</div>
            </section>
          </article>
          
          <section class="max-w-5xl px-4 mx-auto recommended-articles">
            <h3>More articles from OpenReplay Blog</h3>
            <div class="grid grid-cols-2 gap-4 2xs:grid-cols-1 xs:grid-cols-1 sm:grid-cols-2">
              <div class="col-span-1">
                          <a href="https://blog.openreplay.com/forever-functional-immutable-objects-for-safer-state/" class="transition-all duration-75 ease-in-out h-full block relative top-0  astro-IFEVH35O" data-test="article-card">

  <img class="card-cover astro-IFEVH35O astro-BC75XJVV" alt="Learn how immutability can be applied to create a safer state in your applications" width="360" height="192" src="./Building a Chess Game with React_files/hero_Z1AK44P.webp" loading="lazy" decoding="async">


  <div class="py-2  astro-IFEVH35O">
    <p class="text-xs text-slate-400 mt-4 flex items-center astro-IFEVH35O">
      Oct 14, 2021, 4 min read
    </p>
    <h2 class="font-bold text-2xl leading-tight astro-IFEVH35O">
      Forever Functional:  Immutable objects for safer state
    </h2>
   <!-- <p>
      {post.frontmatter.excerpt}
    </p> -->
  </div>
</a>
                    </div><div class="col-span-1">
                          <a href="https://blog.openreplay.com/forever-functional-injecting-for-purity/" class="transition-all duration-75 ease-in-out h-full block relative top-0  astro-IFEVH35O" data-test="article-card">

  <img class="card-cover astro-IFEVH35O astro-BC75XJVV" alt="Pure functions are the cornerstone of Functional Programming, but we must also learn how to deal with impurity in our code" width="360" height="192" src="./Building a Chess Game with React_files/hero_Z2grJrC.webp" loading="lazy" decoding="async">


  <div class="py-2  astro-IFEVH35O">
    <p class="text-xs text-slate-400 mt-4 flex items-center astro-IFEVH35O">
      Aug 10, 2021, 6 min read
    </p>
    <h2 class="font-bold text-2xl leading-tight astro-IFEVH35O">
      Forever Functional: Injecting for Purity
    </h2>
   <!-- <p>
      {post.frontmatter.excerpt}
    </p> -->
  </div>
</a>
                    </div>
            </div>
        </section>
  </div>
  
  
  <!--<div class="rhs-bar hidden xl:flex w-full xl:w-3/12 relative">
    
  </div>-->

</div>
    </main>
    <!-- START Bootstrap-Cookie-Alert --><div class="alert text-center cookiealert border-top" role="alert">
  OpenReplay relies on <a href="https://openreplay.com/privacy.html" target="_blank" class="me-1 text-white text-decoration-dashed">cookies</a> to make its website easier to use.
  <button type="button" class="btn btn-primary btn-sm  acceptcookies text-white d-block d-lg-inline m-auto mt-2" aria-label="Close">
  I Accept
  </button>
</div>

<section class="css-32fml1 e9w9r0m0 social-footer border-t border-slate-100 px-4 py-10 2xs:p-5 my-5">
  <div class="max-w-7xl flex flex-row 2xs:flex-col sm:flex-row items-center justify-between mx-auto">
    <div class="css-1pt7hv6 e9nvoze2">© 2023 <a href="https://openreplay.com/">OpenReplay</a> Blog</div>
    <div class="flex flex-row mt-3 gap-4">
      <a target="_blank" rel="noopener nofollow" data-a11y="false" aria-label="Link to https://twitter.com/OpenReplayHQ" href="https://twitter.com/OpenReplayHQ" class="max-w-[16px]">
        <svg width="20" height="20" viewBox="0 0 16 13" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.0658 2.34438C14.7013 1.96349 15.1892 1.3604 15.419 0.641811C14.8244 0.994439 14.1658 1.25056 13.4648 1.3886C12.9034 0.7905 12.1036 0.416748 11.2185 0.416748C9.51888 0.416748 8.14096 1.79461 8.14096 3.49411C8.14096 3.7353 8.16822 3.97019 8.22068 4.19542C5.66301 4.06708 3.39543 2.84191 1.8776 0.980064C1.6127 1.43458 1.46094 1.96322 1.46094 2.52719C1.46094 3.59485 2.00428 4.5368 2.83003 5.08865C2.32553 5.07268 1.85104 4.93425 1.43608 4.70376C1.43586 4.71659 1.43586 4.72949 1.43586 4.74244C1.43586 6.23349 2.49666 7.47732 3.90448 7.75999C3.64622 7.83033 3.37436 7.86792 3.09366 7.86792C2.89537 7.86792 2.70257 7.84866 2.51471 7.81272C2.90629 9.03537 4.0428 9.92509 5.38945 9.94994C4.33623 10.7753 3.00928 11.2673 1.56749 11.2673C1.31911 11.2673 1.07413 11.2528 0.833374 11.2243C2.19527 12.0975 3.81291 12.6069 5.55081 12.6069C11.2113 12.6069 14.3067 7.91763 14.3067 3.85096C14.3067 3.71753 14.3037 3.5848 14.2978 3.45285C14.899 3.01896 15.4208 2.47694 15.8334 1.8598C15.2815 2.10456 14.6884 2.26998 14.0658 2.34438Z" fill="#73737D"></path></svg>
      </a>
      <a target="_blank" rel="noopener nofollow" data-a11y="false" aria-label="Link to https://github.com/openreplay/openreplay" href="https://github.com/openreplay/openreplay" class="max-w-[16px]">
        <svg width="20" height="20" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7 0C3.1325 0 0 3.21173 0 7.17706C0 10.3529 2.00375 13.0353 4.78625 13.9863C5.13625 14.0491 5.2675 13.8338 5.2675 13.6454C5.2675 13.4749 5.25875 12.9097 5.25875 12.3087C3.5 12.6406 3.045 11.8691 2.905 11.4653C2.82625 11.259 2.485 10.622 2.1875 10.4516C1.9425 10.317 1.5925 9.98508 2.17875 9.97611C2.73 9.96714 3.12375 10.4964 3.255 10.7118C3.885 11.7973 4.89125 11.4923 5.29375 11.3039C5.355 10.8374 5.53875 10.5234 5.74 10.3439C4.1825 10.1645 2.555 9.54549 2.555 6.80026C2.555 6.01976 2.82625 5.37382 3.2725 4.87143C3.2025 4.692 2.9575 3.95635 3.3425 2.96951C3.3425 2.96951 3.92875 2.78111 5.2675 3.70516C5.8275 3.54367 6.4225 3.46293 7.0175 3.46293C7.6125 3.46293 8.2075 3.54367 8.7675 3.70516C10.1063 2.77214 10.6925 2.96951 10.6925 2.96951C11.0775 3.95635 10.8325 4.692 10.7625 4.87143C11.2087 5.37382 11.48 6.01079 11.48 6.80026C11.48 9.55446 9.84375 10.1645 8.28625 10.3439C8.54 10.5682 8.75875 10.9988 8.75875 11.6717C8.75875 12.6316 8.75 13.4032 8.75 13.6454C8.75 13.8338 8.88125 14.0581 9.23125 13.9863C11.9963 13.0353 14 10.3439 14 7.17706C14 3.21173 10.8675 0 7 0Z" fill="#73737D"></path></svg>
      </a>
      <a target="_blank" rel="noopener nofollow" data-a11y="false" aria-label="Link to https://www.linkedin.com/company/18257552" href="https://www.linkedin.com/company/18257552" class="max-w-[16px">
        <svg width="20" height="20" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.59615 13.125H0.871552V4.36523H3.59615V13.125ZM2.24847 3.16406C1.81878 3.16406 1.44769 3.00781 1.13519 2.69531C0.822692 2.38281 0.666443 2.01171 0.666443 1.58203C0.666443 1.15234 0.822692 0.781248 1.13519 0.468749C1.44769 0.156249 1.81878 0 2.24847 0C2.67816 0 3.04925 0.156249 3.36175 0.468749C3.67425 0.781248 3.8305 1.15234 3.8305 1.58203C3.8305 2.01171 3.67425 2.38281 3.36175 2.69531C3.04925 3.00781 2.67816 3.16406 2.24847 3.16406ZM13.7915 13.125H11.0669V8.84765C11.0669 8.14452 11.0083 7.63671 10.8911 7.32421C10.6763 6.79687 10.2563 6.5332 9.63134 6.5332C9.00634 6.5332 8.56689 6.76757 8.31298 7.23632C8.11767 7.58788 8.02001 8.10546 8.02001 8.78905V13.125H5.32471V4.36523H7.93212V5.5664H7.96142C8.15673 5.17578 8.46923 4.85351 8.89892 4.59961C9.36767 4.28711 9.91454 4.13086 10.5395 4.13086C11.8091 4.13086 12.6977 4.53125 13.2055 5.33203C13.5962 5.97656 13.7915 6.97265 13.7915 8.3203V13.125Z" fill="#73737D"></path></svg>
      </a>
    </div>
  </div>
</section>

<!-- Prism JS -->






  </body></html>